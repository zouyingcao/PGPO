<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Generated by indoc on 29 May 2018 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_RB.css" rel="stylesheet" type="text/css" />
<title>10.1. Gases</title>
<script type="text/javascript">
    function showExtra(id, imid) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
            document.getElementById(imid).src = 'Documentation/Images/extra.png';
        } else {
            document.getElementById(id).style.display = 'block';
            document.getElementById(imid).src = 'Documentation/Images/extraclose.png';
        }
    }
    function onLoaded() {
        if (window.location.hash) {
            var hash = window.location.hash.substring(2);
            if (hash.search("_") >= 0) {
                var res = hash.split("_");
                showExample("example"+res[1]);
            } else {
                showExample("example"+hash);
            }
        }
    }
    window.onload=onLoaded;
    function showExample(id) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).style.display = 'block';
        }
    }
    function openExtra(id, imid) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(imid).src = 'Documentation/Images/extraclose.png';
    }
    function closeExtra(id, imid) {
        document.getElementById(id).style.display = 'none';
        document.getElementById(imid).src = 'Documentation/Images/extra.png';
    }
</script>
</head>
<body class="paper papertint"><script language="JavaScript">
function pasteCode(code) {
    var myProject = window.Project;

    myProject.selectView('source');
    myProject.pasteCode(code);
}
</script>
<script language="JavaScript">
function createNewProject(code, title) {
    var myProject = window.Project;

    myProject.createNewProject(title, code);
}
</script>
<p class="chapterheading">Chapter 10: Physics: Substances, Ropes, Energy and Weight</p>
<p class="chaptercontents"><a href="RB_10_1.html" class="standardlink"><span class="chaptercontentsitem">§10.1. Gases</span></a>; <a href="RB_10_2.html" class="standardlink"><span class="chaptercontentsitem">§10.2. Liquids</span></a>; <a href="RB_10_3.html" class="standardlink"><span class="chaptercontentsitem">§10.3. Dispensers and Supplies of Small Objects</span></a>; <a href="RB_10_4.html" class="standardlink"><span class="chaptercontentsitem">§10.4. Glass and Other Damage-Prone Substances</span></a>; <a href="RB_10_5.html" class="standardlink"><span class="chaptercontentsitem">§10.5. Volume, Height, Weight</span></a>; <a href="RB_10_6.html" class="standardlink"><span class="chaptercontentsitem">§10.6. Ropes</span></a>; <a href="RB_10_7.html" class="standardlink"><span class="chaptercontentsitem">§10.7. Electricity and Magnetism</span></a>; <a href="RB_10_8.html" class="standardlink"><span class="chaptercontentsitem">§10.8. Fire</span></a>; <a href="RB_10_9.html" class="standardlink"><span class="chaptercontentsitem">§10.9. Heat</span></a>; <a href="RB_10_10.html" class="standardlink"><span class="chaptercontentsitem">§10.10. Magic (Breaking the Laws of Physics)</span></a>; <a href="RB_10_11.html" class="standardlink"><span class="chaptercontentsitem">§10.11. Mathematics</span></a></p><table class="centredtable"><tr><td class="roadsigndirection"><a href="RB_1_1.html" class="standardlink"><img alt="arrow-up-left.png" src="Documentation/Images/arrow-up-left.png" /></a></td><td><a href="RB_1_1.html" class="standardlink">Contents of <i>The Inform Recipe Book</i></a></td></tr>
<tr><td class="roadsigndirection"><a href="RB_9_1.html" class="standardlink"><img alt="arrow-left.png" src="Documentation/Images/arrow-left.png" /></a></td><td><a href="RB_9_1.html" class="standardlink">Chapter 9: Props: Food, Clothing, Money, Toys, Books, Electronics</a></td></tr>
<tr><td class="roadsigndirection"><a href="RB_11_1.html" class="standardlink"><img alt="arrow-right.png" src="Documentation/Images/arrow-right.png" /></a></td><td><a href="RB_11_1.html" class="standardlink">Chapter 11: Out Of World Actions and Effects</a></td></tr>
<tr><td class="roadsigndirection"><a href="examples_alphabetical.html" class="standardlink"><img alt="arrow-down-right.png" src="Documentation/Images/arrow-down-right.png" /></a></td><td><a href="examples_alphabetical.html" class="standardlink">Indexes of the examples</a></td></tr>
</table><p class="sectionheading">§10.1. Gases</p>
<p>Inform normally assumes that everything is solid. It has no built-in support for gases or liquids, because they have so many different behaviours. For instance, is the important thing about gas that it diffuses, or that we breathe it, or that it mixes with other gases to react, or that it sometimes obscures vision? The answer depends on what we are trying to write, and for this reason Inform leaves it up to us.</p>
<p>Gases are easier to deal with than liquids, because they tend to be everywhere in their location at once (unlike a liquid which might form a pool on the floor) and because they diffuse and mix by themselves (rather than being carried around or brought into contact with each other by the player). On the other hand, unlike liquids, gases are compressible: they can be present at low or high pressures, that is, in low or high concentrations.</p>
<p>The simplest approach is the one in <span class="boldface">Only You...</span>, where rooms are either filled with smoke or else smoke-free. Smoke gradually fills through the map, obscuring vision: no attempt is made to conserve the total quantity of smoke, as we assume that some fire is churning it out continuously to replace what diffuses away.</p>
<p><span class="boldface">Lethal Concentration 1</span> and <span class="boldface">2</span> simulate a gas diffusing through a three-dimensional maze of rooms, and becoming dangerous above certain concentrations. There is just one possible gas, and it is modelled by giving each room a number which represents the concentration (in parts per million). This enables us to conserve the total amount of gas, or to have it released or captured by sources and sinks of given capacity.</p>
<p>This could be extended by giving each room similar concentration levels for other gases, and providing for the diffusion rule to notice when different gases come into contact; or by giving a concentration (and also, for realism, a volume) to each closed container, applying rules for capturing and releasing gases as containers are opened and closed.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="RB_10_1.html" class="standardlink"><img alt="arrow-up.png" src="Documentation/Images/arrow-up.png" /></a></td><td><a href="RB_10_1.html" class="standardlink">Start of Chapter 10: Physics: Substances, Ropes, Energy and Weight</a></td></tr>
<tr><td class="roadsigndirection"><a href="RB_9_12.html" class="standardlink"><img alt="arrow-left.png" src="Documentation/Images/arrow-left.png" /></a></td><td><a href="RB_9_12.html" class="standardlink">Back to Chapter 9: Props: Food, Clothing, Money, Toys, Books, Electronics: §9.12. Cameras and Recording Devices</a></td></tr>
<tr><td class="roadsigndirection"><a href="RB_10_2.html" class="standardlink"><img alt="arrow-right.png" src="Documentation/Images/arrow-right.png" /></a></td><td><a href="RB_10_2.html" class="standardlink">Onward to §10.2. Liquids</a></td></tr>
</table><hr />
</div>
<div class="bookexamples">
<p class="chapterheading"></p><a id="e276"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<!-- EXAMPLE START -->
<a href="RB_10_1.html#e276" class="eglink"><b>255</b></a></div>
<div class="egpanel" id="example276">
<!-- START CODE "c31949" -->
<a id="c31949"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Lethal Concentration[=0x0022=][=0x000A=][=0x000A=]A concentration is a kind of value. 200.9ppm specifies concentration. 200.9 ppm specifies concentration.[=0x000A=][=0x000A=]A room has a concentration called current concentration. A room has a concentration called former concentration.[=0x000A=][=0x000A=]Probability inverse is a number that varies. [This is expressed as an inverse of the actual probability of diffusion from one room to another, to avoid error.] Probability inverse is 20. [That is, any given molecule of gas has a 5% chance of leaving by a given doorway at any given minute. Probability inverse should never drop below 10, the maximum number of exits from the room.][=0x000A=][=0x000A=]Every turn:[=0x000A=][=0x0009=]follow the diffusion rules.[=0x000A=][=0x000A=]The diffusion rules are a rulebook.[=0x000A=][=0x000A=]A diffusion rule (this is the gas movement rule):[=0x000A=][=0x0009=]repeat with space running through rooms:[=0x000A=][=0x0009=][=0x0009=]let sum be 0.0 ppm;[=0x000A=][=0x0009=][=0x0009=]repeat with way running through directions:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]let second space be the room way from the space;[=0x000A=][=0x0009=][=0x0009=][=0x0009=]if second space is a room:[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]let difference be the former concentration of the second space minus the former concentration of the space;[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]increase sum by the difference;[=0x000A=][=0x0009=][=0x0009=]let sum be sum divided by probability inverse;[=0x000A=][=0x0009=][=0x0009=]now current concentration of the space is the former concentration of the space plus the sum.[=0x000A=][=0x000A=][A technical note: it would be possible to write [=0x0022=]repeat with space running through rooms... repeat with second space running through rooms adjacent to the space[=0x0022=] instead, but in practice this loops through all the rooms * all the rooms again * all the directions (to determine adjacency). Phrasing the loop this way omits the second multiplier. For a map of 25 rooms, this means that the loop runs 25 times faster than it would otherwise, and of course for a larger map the effect would be even more dramatic.][=0x000A=][=0x000A=]A diffusion rule (this is the resetting concentration rule):[=0x000A=][=0x0009=]repeat with space running through rooms:[=0x000A=][=0x0009=][=0x0009=]now the former concentration of the space is the current concentration of the space.[=0x000A=][=0x000A=]The last diffusion rule (this is the lethal dosage rule):[=0x000A=][=0x0009=]if the current concentration of the location is greater than LC50:[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]The concentration in the air overpowers you...[=0x0022=];[=0x000A=][=0x0009=][=0x0009=]end the story;[=0x000A=][=0x0009=]otherwise:[=0x000A=][=0x0009=][=0x0009=]if the current concentration of the location is greater than TLV-STEL:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]say [=0x0022=]You feel extremely uncomfortable in this environment.[=0x0022=][=0x000A=][=0x000A=]Instead of doing something when the current concentration of the location is greater than TLV-STEL:[=0x000A=][=0x0009=]if going, continue the action;[=0x000A=][=0x0009=]say [=0x0022=]You can[=0x0027=]t work in this environment: your eyes and nose sting and it hurts to breathe.[=0x0022=][=0x000A=][=0x000A=][And, for testing purposes, a square grid of rooms:][=0x000A=][=0x000A=]Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.[=0x000A=][=0x000A=]Room 2A is south of room 1A and west of Room 2B. Room 2B is west of Room 2C and south of Room 1B. Room 2C is west of Room 2D and south of Room 1C. Room 2D is west of Room 2E and south of Room 1D. Room 2E is south of Room 1E.[=0x000A=][=0x000A=]Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C and south of Room 2B. Room 3C is west of Room 3D and south of Room 2C. Room 3D is west of Room 3E and south of Room 2D. Room 3E is south of Room 2E.[=0x000A=][=0x000A=]Room 4A is south of room 3A and west of Room 4B. Room 4B is west of Room 4C and south of Room 3B. Room 4C is west of Room 4D and south of Room 3C. Room 4D is west of Room 4E and south of Room 3D. Room 4E is south of Room 3E.[=0x000A=][=0x000A=]Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.[=0x000A=][=0x000A=]The former concentration of room 3C is 800.0 ppm.[=0x000A=][=0x000A=][For variety of testing, here is another room set-up, this time with some corridors and walls within; uncommenting it, and commenting out the connected grid, will let us explore what would happen in alternative cases, to prove to ourselves that the model works consistently.][=0x000A=][=0x000A=][Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.[=0x000A=][=0x000A=]Room 2A is west of Room 2B. Room 2B is west of Room 2C. Room 2C is west of Room 2D. Room 2D is west of Room 2E. Room 2E is south of Room 1E.[=0x000A=][=0x000A=]Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C. Room 3C is west of Room 3D. Room 3D is west of Room 3E.[=0x000A=][=0x000A=]Room 4A is west of Room 4B. Room 4B is west of Room 4C. Room 4C is west of Room 4D. Room 4D is west of Room 4E. Room 4E is south of Room 3E.[=0x000A=][=0x000A=]Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.][=0x000A=][=0x000A=][For the sake at least of seeing what[=0x0027=]s going on in the example, let[=0x0027=]s also provide the player with the means to view the gas diffusion graphically:][=0x000A=][=0x000A=]The status grid is a device carried by the player. The status grid is switched on.[=0x000A=][=0x000A=]Every turn:[=0x000A=][=0x0009=]try examining the grid.[=0x000A=][=0x000A=]Instead of examining the status grid:[=0x000A=][=0x0009=]say [=0x0022=][fixed letter spacing][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 1A]|[state of room 1B]|[state of room 1C]|[state of room 1D]|[state of room 1E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 2A]|[state of room 2B]|[state of room 2C]|[state of room 2D]|[state of room 2E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 3A]|[state of room 3B]|[state of room 3C]|[state of room 3D]|[state of room 3E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 4A]|[state of room 4B]|[state of room 4C]|[state of room 4D]|[state of room 4E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 5A]|[state of room 5B]|[state of room 5C]|[state of room 5D]|[state of room 5E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][variable letter spacing][line break][=0x0022=].[=0x000A=][=0x000A=]To say bar:[=0x000A=][=0x0009=]say [=0x0022=]----------------------------------------------[=0x0022=].[=0x000A=][=0x000A=]TLV is a concentration that varies. TLV is 30.0ppm. [Long-term exposure maximum, safe for 8 hours a day.][=0x000A=][=0x000A=]TLV-STEL is a concentration that varies. TLV-STEL is 50.0ppm. [Short-term exposure maximum, safe for fifteen minutes max.][=0x000A=][=0x000A=]TLV-C is a concentration that varies. TLV-C is 150.0ppm. [Absolute exposure ceiling.][=0x000A=][=0x000A=]LC50 is a concentration that varies. LC50 is 300.0ppm. [Concentration at which 50 percent of test subjects die of exposure, usually expressed in terms of time and body weight; in our LC50 these are factored in for the player[=0x0027=]s weight for one minute.][=0x000A=][=0x000A=][The values set for these would depend on the type of poisonous gas in question; we[=0x0027=]d want to adjust appropriately.][=0x000A=][=0x000A=]To say state of (space - a room):[=0x000A=][=0x0009=]if the space is the location, say bold type;[=0x000A=][=0x0009=]if current concentration of space is less than 10.0ppm, say [=0x0022=] [=0x0022=];[=0x000A=][=0x0009=]if current concentration of space is less than 100.0ppm, say [=0x0022=] [=0x0022=];[=0x000A=][=0x0009=]say current concentration of space;[=0x000A=][=0x0009=]say roman type.[=0x000A=][=0x000A=][Now, in theory we might also want to account for sources and sinks, items that either inject poisonous gas into the environment or remove it again. For simplicity, we will assume that these contributions can also be calculated in ppm and that the total number of inert and poisonous gas molecules in a room never changes (so if poison gas molecules are added, an equal number of inert molecules are removed). If room pressure were able to change, our model would have to be improved, so let us assume for now that that never happens. We want this sink/source business to calculate before any other portion of the diffusion rulebook, so set it as a first diffusion rule.][=0x000A=][=0x000A=]A gas source is a kind of thing. A gas source has a concentration called the contribution. The contribution of a gas source is usually 30.0ppm.[=0x000A=][=0x000A=]Room 2B contains a gas source called a spigot. The contribution of the spigot is 50.0ppm. Room 5A contains a gas source.[=0x000A=][=0x000A=]A gas sink is a kind of thing. A gas sink has a concentration called the contribution. The contribution of a gas sink is usually 30.0ppm.[=0x000A=][=0x000A=]Room 5E contains a gas sink called a fan. The contribution of the fan is 80.0ppm.[=0x000A=][=0x000A=]The first diffusion rule (this is the sources and sinks rule):[=0x000A=][=0x0009=]follow the sources rule;[=0x000A=][=0x0009=]follow the sinks rule.[=0x000A=][=0x000A=]This is the sinks rule:[=0x000A=][=0x0009=]repeat with item running through gas sinks:[=0x000A=][=0x0009=][=0x0009=]let space be the location of the item;[=0x000A=][=0x0009=][=0x0009=]decrease the former concentration of the space by the contribution of the item;[=0x000A=][=0x0009=][=0x0009=]if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.[=0x000A=][=0x000A=]This is the sources rule:[=0x000A=][=0x0009=]repeat with second item running through gas sources:[=0x000A=][=0x0009=][=0x0009=]let space be the location of the second item;[=0x000A=][=0x0009=][=0x0009=]increase the former concentration of the space by the contribution of the second item;[=0x000A=][=0x0009=][=0x0009=]if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.[=0x000A=][=0x000A=]Test me with [=0x0022=]z / z / z / z / z / z / z / z[=0x0022=].[=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Lethal Concentration&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31950" -->
<a id="c31950"></a><blockquote class="code"><p class="quoted">
A concentration is a kind of value. 200.9ppm specifies concentration. 200.9 ppm specifies concentration.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31951" -->
<a id="c31951"></a><blockquote class="code"><p class="quoted">
A room has a concentration called current concentration. A room has a concentration called former concentration.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31952" -->
<a id="c31952"></a><blockquote class="code"><p class="quoted">
Probability inverse is a number that varies. [This is expressed as an inverse of the actual probability of diffusion from one room to another, to avoid error.] Probability inverse is 20. [That is, any given molecule of gas has a 5% chance of leaving by a given doorway at any given minute. Probability inverse should never drop below 10, the maximum number of exits from the room.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31953" -->
<a id="c31953"></a><blockquote class="code"><p class="quoted">
Every turn:
<br />&#160;&#160;&#160;&#160;follow the diffusion rules.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31954" -->
<a id="c31954"></a><blockquote class="code"><p class="quoted">
The diffusion rules are a rulebook.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31955" -->
<a id="c31955"></a><blockquote class="code"><p class="quoted">
A diffusion rule (this is the gas movement rule):
<br />&#160;&#160;&#160;&#160;repeat with space running through rooms:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let sum be 0.0 ppm;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repeat with way running through directions:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let second space be the room way from the space;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if second space is a room:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let difference be the former concentration of the second space minus the former concentration of the space;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;increase sum by the difference;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let sum be sum divided by probability inverse;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now current concentration of the space is the former concentration of the space plus the sum.
</p></blockquote>
<!-- END CODE -->
<p>A technical note: it would be possible to write &quot;repeat with space running through rooms... repeat with second space running through rooms adjacent to the space&quot; instead, but in practice this loops through all the rooms * all the rooms again * all the directions (to determine adjacency). Phrasing the loop this way omits the second multiplier. For a map of 25 rooms, this means that the loop runs 25 times faster than it would otherwise, and of course for a larger map the effect would be even more dramatic.</p>
<!-- START CODE "c31956" -->
<a id="c31956"></a><blockquote class="code"><p class="quoted">
A diffusion rule (this is the resetting concentration rule):
<br />&#160;&#160;&#160;&#160;repeat with space running through rooms:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the former concentration of the space is the current concentration of the space.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31957" -->
<a id="c31957"></a><blockquote class="code"><p class="quoted">
The last diffusion rule (this is the lethal dosage rule):
<br />&#160;&#160;&#160;&#160;if the current concentration of the location is greater than LC50:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;The concentration in the air overpowers you...&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end the story;
<br />&#160;&#160;&#160;&#160;otherwise:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the current concentration of the location is greater than TLV-STEL:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;You feel extremely uncomfortable in this environment.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31958" -->
<a id="c31958"></a><blockquote class="code"><p class="quoted">
Instead of doing something when the current concentration of the location is greater than TLV-STEL:
<br />&#160;&#160;&#160;&#160;if going, continue the action;
<br />&#160;&#160;&#160;&#160;say &quot;You can't work in this environment: your eyes and nose sting and it hurts to breathe.&quot;
</p></blockquote>
<!-- END CODE -->
<p>And, for testing purposes, a square grid of rooms:</p>
<!-- START CODE "c31959" -->
<a id="c31959"></a><blockquote class="code"><p class="quoted">
Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31960" -->
<a id="c31960"></a><blockquote class="code"><p class="quoted">
Room 2A is south of room 1A and west of Room 2B. Room 2B is west of Room 2C and south of Room 1B. Room 2C is west of Room 2D and south of Room 1C. Room 2D is west of Room 2E and south of Room 1D. Room 2E is south of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31961" -->
<a id="c31961"></a><blockquote class="code"><p class="quoted">
Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C and south of Room 2B. Room 3C is west of Room 3D and south of Room 2C. Room 3D is west of Room 3E and south of Room 2D. Room 3E is south of Room 2E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31962" -->
<a id="c31962"></a><blockquote class="code"><p class="quoted">
Room 4A is south of room 3A and west of Room 4B. Room 4B is west of Room 4C and south of Room 3B. Room 4C is west of Room 4D and south of Room 3C. Room 4D is west of Room 4E and south of Room 3D. Room 4E is south of Room 3E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31963" -->
<a id="c31963"></a><blockquote class="code"><p class="quoted">
Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31964" -->
<a id="c31964"></a><blockquote class="code"><p class="quoted">
The former concentration of room 3C is 800.0 ppm.
</p></blockquote>
<!-- END CODE -->
<p>For variety of testing, here is another room set-up, this time with some corridors and walls within; uncommenting it, and commenting out the connected grid, will let us explore what would happen in alternative cases, to prove to ourselves that the model works consistently.</p>
<!-- START CODE "c31965" -->
<a id="c31965"></a><blockquote class="code"><p class="quoted">
[Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31966" -->
<a id="c31966"></a><blockquote class="code"><p class="quoted">
Room 2A is west of Room 2B. Room 2B is west of Room 2C. Room 2C is west of Room 2D. Room 2D is west of Room 2E. Room 2E is south of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31967" -->
<a id="c31967"></a><blockquote class="code"><p class="quoted">
Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C. Room 3C is west of Room 3D. Room 3D is west of Room 3E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31968" -->
<a id="c31968"></a><blockquote class="code"><p class="quoted">
Room 4A is west of Room 4B. Room 4B is west of Room 4C. Room 4C is west of Room 4D. Room 4D is west of Room 4E. Room 4E is south of Room 3E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31969" -->
<a id="c31969"></a><blockquote class="code"><p class="quoted">
Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.]
</p></blockquote>
<!-- END CODE -->
<p>For the sake at least of seeing what's going on in the example, let's also provide the player with the means to view the gas diffusion graphically:</p>
<!-- START CODE "c31970" -->
<a id="c31970"></a><blockquote class="code"><p class="quoted">
The status grid is a device carried by the player. The status grid is switched on.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31971" -->
<a id="c31971"></a><blockquote class="code"><p class="quoted">
Every turn:
<br />&#160;&#160;&#160;&#160;try examining the grid.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31972" -->
<a id="c31972"></a><blockquote class="code"><p class="quoted">
Instead of examining the status grid:
<br />&#160;&#160;&#160;&#160;say &quot;[fixed letter spacing][bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 1A]|[state of room 1B]|[state of room 1C]|[state of room 1D]|[state of room 1E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 2A]|[state of room 2B]|[state of room 2C]|[state of room 2D]|[state of room 2E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 3A]|[state of room 3B]|[state of room 3C]|[state of room 3D]|[state of room 3E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 4A]|[state of room 4B]|[state of room 4C]|[state of room 4D]|[state of room 4E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 5A]|[state of room 5B]|[state of room 5C]|[state of room 5D]|[state of room 5E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][variable letter spacing][line break]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31973" -->
<a id="c31973"></a><blockquote class="code"><p class="quoted">
To say bar:
<br />&#160;&#160;&#160;&#160;say &quot;----------------------------------------------&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31974" -->
<a id="c31974"></a><blockquote class="code"><p class="quoted">
TLV is a concentration that varies. TLV is 30.0ppm. [Long-term exposure maximum, safe for 8 hours a day.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31975" -->
<a id="c31975"></a><blockquote class="code"><p class="quoted">
TLV-STEL is a concentration that varies. TLV-STEL is 50.0ppm. [Short-term exposure maximum, safe for fifteen minutes max.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31976" -->
<a id="c31976"></a><blockquote class="code"><p class="quoted">
TLV-C is a concentration that varies. TLV-C is 150.0ppm. [Absolute exposure ceiling.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31977" -->
<a id="c31977"></a><blockquote class="code"><p class="quoted">
LC50 is a concentration that varies. LC50 is 300.0ppm. [Concentration at which 50 percent of test subjects die of exposure, usually expressed in terms of time and body weight; in our LC50 these are factored in for the player's weight for one minute.]
</p></blockquote>
<!-- END CODE -->
<p>The values set for these would depend on the type of poisonous gas in question; we'd want to adjust appropriately.</p>
<!-- START CODE "c31978" -->
<a id="c31978"></a><blockquote class="code"><p class="quoted">
To say state of (space - a room):
<br />&#160;&#160;&#160;&#160;if the space is the location, say bold type;
<br />&#160;&#160;&#160;&#160;if current concentration of space is less than 10.0ppm, say &quot; &quot;;
<br />&#160;&#160;&#160;&#160;if current concentration of space is less than 100.0ppm, say &quot; &quot;;
<br />&#160;&#160;&#160;&#160;say current concentration of space;
<br />&#160;&#160;&#160;&#160;say roman type.
</p></blockquote>
<!-- END CODE -->
<p>Now, in theory we might also want to account for sources and sinks, items that either inject poisonous gas into the environment or remove it again. For simplicity, we will assume that these contributions can also be calculated in ppm and that the total number of inert and poisonous gas molecules in a room never changes (so if poison gas molecules are added, an equal number of inert molecules are removed). If room pressure were able to change, our model would have to be improved, so let us assume for now that that never happens. We want this sink/source business to calculate before any other portion of the diffusion rulebook, so set it as a first diffusion rule.</p>
<!-- START CODE "c31979" -->
<a id="c31979"></a><blockquote class="code"><p class="quoted">
A gas source is a kind of thing. A gas source has a concentration called the contribution. The contribution of a gas source is usually 30.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31980" -->
<a id="c31980"></a><blockquote class="code"><p class="quoted">
Room 2B contains a gas source called a spigot. The contribution of the spigot is 50.0ppm. Room 5A contains a gas source.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31981" -->
<a id="c31981"></a><blockquote class="code"><p class="quoted">
A gas sink is a kind of thing. A gas sink has a concentration called the contribution. The contribution of a gas sink is usually 30.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31982" -->
<a id="c31982"></a><blockquote class="code"><p class="quoted">
Room 5E contains a gas sink called a fan. The contribution of the fan is 80.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31983" -->
<a id="c31983"></a><blockquote class="code"><p class="quoted">
The first diffusion rule (this is the sources and sinks rule):
<br />&#160;&#160;&#160;&#160;follow the sources rule;
<br />&#160;&#160;&#160;&#160;follow the sinks rule.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31984" -->
<a id="c31984"></a><blockquote class="code"><p class="quoted">
This is the sinks rule:
<br />&#160;&#160;&#160;&#160;repeat with item running through gas sinks:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let space be the location of the item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;decrease the former concentration of the space by the contribution of the item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31985" -->
<a id="c31985"></a><blockquote class="code"><p class="quoted">
This is the sources rule:
<br />&#160;&#160;&#160;&#160;repeat with second item running through gas sources:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let space be the location of the second item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;increase the former concentration of the space by the contribution of the second item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31986" -->
<a id="c31986"></a><blockquote class="code"><p class="quoted">
Test me with &quot;z / z / z / z / z / z / z / z&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<!-- EXAMPLE END -->
<!-- EXAMPLE START -->
</td><td class="egnamecell"><p class="egcuetext"><a href="RB_10_1.html#e276" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner"><b>Example</b></span><span class="egname">Lethal Concentration 1</span></b></a><br />A poisonous gas that spreads from room to room, incapacitating or killing the player when it reaches sufficient levels.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egpanel" id="example276">
<!-- START CODE "c31987" -->
<a id="c31987"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Lethal Concentration[=0x0022=][=0x000A=][=0x000A=]A concentration is a kind of value. 200.9ppm specifies concentration. 200.9 ppm specifies concentration.[=0x000A=][=0x000A=]A room has a concentration called current concentration. A room has a concentration called former concentration.[=0x000A=][=0x000A=]Probability inverse is a number that varies. [This is expressed as an inverse of the actual probability of diffusion from one room to another, to avoid error.] Probability inverse is 20. [That is, any given molecule of gas has a 5% chance of leaving by a given doorway at any given minute. Probability inverse should never drop below 10, the maximum number of exits from the room.][=0x000A=][=0x000A=]Every turn:[=0x000A=][=0x0009=]follow the diffusion rules.[=0x000A=][=0x000A=]The diffusion rules are a rulebook.[=0x000A=][=0x000A=]A diffusion rule (this is the gas movement rule):[=0x000A=][=0x0009=]repeat with space running through rooms:[=0x000A=][=0x0009=][=0x0009=]let sum be 0.0 ppm;[=0x000A=][=0x0009=][=0x0009=]repeat with way running through directions:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]let second space be the room way from the space;[=0x000A=][=0x0009=][=0x0009=][=0x0009=]if second space is a room:[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]let difference be the former concentration of the second space minus the former concentration of the space;[=0x000A=][=0x0009=][=0x0009=][=0x0009=][=0x0009=]increase sum by the difference;[=0x000A=][=0x0009=][=0x0009=]let sum be sum divided by probability inverse;[=0x000A=][=0x0009=][=0x0009=]now current concentration of the space is the former concentration of the space plus the sum.[=0x000A=][=0x000A=][A technical note: it would be possible to write [=0x0022=]repeat with space running through rooms... repeat with second space running through rooms adjacent to the space[=0x0022=] instead, but in practice this loops through all the rooms * all the rooms again * all the directions (to determine adjacency). Phrasing the loop this way omits the second multiplier. For a map of 25 rooms, this means that the loop runs 25 times faster than it would otherwise, and of course for a larger map the effect would be even more dramatic.][=0x000A=][=0x000A=]A diffusion rule (this is the resetting concentration rule):[=0x000A=][=0x0009=]repeat with space running through rooms:[=0x000A=][=0x0009=][=0x0009=]now the former concentration of the space is the current concentration of the space.[=0x000A=][=0x000A=]The last diffusion rule (this is the lethal dosage rule):[=0x000A=][=0x0009=]if the current concentration of the location is greater than LC50:[=0x000A=][=0x0009=][=0x0009=]say [=0x0022=]The concentration in the air overpowers you...[=0x0022=];[=0x000A=][=0x0009=][=0x0009=]end the story;[=0x000A=][=0x0009=]otherwise:[=0x000A=][=0x0009=][=0x0009=]if the current concentration of the location is greater than TLV-STEL:[=0x000A=][=0x0009=][=0x0009=][=0x0009=]say [=0x0022=]You feel extremely uncomfortable in this environment.[=0x0022=][=0x000A=][=0x000A=]Instead of doing something when the current concentration of the location is greater than TLV-STEL:[=0x000A=][=0x0009=]if going, continue the action;[=0x000A=][=0x0009=]say [=0x0022=]You can[=0x0027=]t work in this environment: your eyes and nose sting and it hurts to breathe.[=0x0022=][=0x000A=][=0x000A=][And, for testing purposes, a square grid of rooms:][=0x000A=][=0x000A=]Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.[=0x000A=][=0x000A=]Room 2A is south of room 1A and west of Room 2B. Room 2B is west of Room 2C and south of Room 1B. Room 2C is west of Room 2D and south of Room 1C. Room 2D is west of Room 2E and south of Room 1D. Room 2E is south of Room 1E.[=0x000A=][=0x000A=]Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C and south of Room 2B. Room 3C is west of Room 3D and south of Room 2C. Room 3D is west of Room 3E and south of Room 2D. Room 3E is south of Room 2E.[=0x000A=][=0x000A=]Room 4A is south of room 3A and west of Room 4B. Room 4B is west of Room 4C and south of Room 3B. Room 4C is west of Room 4D and south of Room 3C. Room 4D is west of Room 4E and south of Room 3D. Room 4E is south of Room 3E.[=0x000A=][=0x000A=]Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.[=0x000A=][=0x000A=]The former concentration of room 3C is 800.0 ppm.[=0x000A=][=0x000A=][For variety of testing, here is another room set-up, this time with some corridors and walls within; uncommenting it, and commenting out the connected grid, will let us explore what would happen in alternative cases, to prove to ourselves that the model works consistently.][=0x000A=][=0x000A=][Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.[=0x000A=][=0x000A=]Room 2A is west of Room 2B. Room 2B is west of Room 2C. Room 2C is west of Room 2D. Room 2D is west of Room 2E. Room 2E is south of Room 1E.[=0x000A=][=0x000A=]Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C. Room 3C is west of Room 3D. Room 3D is west of Room 3E.[=0x000A=][=0x000A=]Room 4A is west of Room 4B. Room 4B is west of Room 4C. Room 4C is west of Room 4D. Room 4D is west of Room 4E. Room 4E is south of Room 3E.[=0x000A=][=0x000A=]Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.][=0x000A=][=0x000A=][For the sake at least of seeing what[=0x0027=]s going on in the example, let[=0x0027=]s also provide the player with the means to view the gas diffusion graphically:][=0x000A=][=0x000A=]The status grid is a device carried by the player. The status grid is switched on.[=0x000A=][=0x000A=]Every turn:[=0x000A=][=0x0009=]try examining the grid.[=0x000A=][=0x000A=]Instead of examining the status grid:[=0x000A=][=0x0009=]say [=0x0022=][fixed letter spacing][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 1A]|[state of room 1B]|[state of room 1C]|[state of room 1D]|[state of room 1E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 2A]|[state of room 2B]|[state of room 2C]|[state of room 2D]|[state of room 2E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 3A]|[state of room 3B]|[state of room 3C]|[state of room 3D]|[state of room 3E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 4A]|[state of room 4B]|[state of room 4C]|[state of room 4D]|[state of room 4E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=]|[state of room 5A]|[state of room 5B]|[state of room 5C]|[state of room 5D]|[state of room 5E]|[line break][=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=][bar][variable letter spacing][line break][=0x0022=].[=0x000A=][=0x000A=]To say bar:[=0x000A=][=0x0009=]say [=0x0022=]----------------------------------------------[=0x0022=].[=0x000A=][=0x000A=]TLV is a concentration that varies. TLV is 30.0ppm. [Long-term exposure maximum, safe for 8 hours a day.][=0x000A=][=0x000A=]TLV-STEL is a concentration that varies. TLV-STEL is 50.0ppm. [Short-term exposure maximum, safe for fifteen minutes max.][=0x000A=][=0x000A=]TLV-C is a concentration that varies. TLV-C is 150.0ppm. [Absolute exposure ceiling.][=0x000A=][=0x000A=]LC50 is a concentration that varies. LC50 is 300.0ppm. [Concentration at which 50 percent of test subjects die of exposure, usually expressed in terms of time and body weight; in our LC50 these are factored in for the player[=0x0027=]s weight for one minute.][=0x000A=][=0x000A=][The values set for these would depend on the type of poisonous gas in question; we[=0x0027=]d want to adjust appropriately.][=0x000A=][=0x000A=]To say state of (space - a room):[=0x000A=][=0x0009=]if the space is the location, say bold type;[=0x000A=][=0x0009=]if current concentration of space is less than 10.0ppm, say [=0x0022=] [=0x0022=];[=0x000A=][=0x0009=]if current concentration of space is less than 100.0ppm, say [=0x0022=] [=0x0022=];[=0x000A=][=0x0009=]say current concentration of space;[=0x000A=][=0x0009=]say roman type.[=0x000A=][=0x000A=][Now, in theory we might also want to account for sources and sinks, items that either inject poisonous gas into the environment or remove it again. For simplicity, we will assume that these contributions can also be calculated in ppm and that the total number of inert and poisonous gas molecules in a room never changes (so if poison gas molecules are added, an equal number of inert molecules are removed). If room pressure were able to change, our model would have to be improved, so let us assume for now that that never happens. We want this sink/source business to calculate before any other portion of the diffusion rulebook, so set it as a first diffusion rule.][=0x000A=][=0x000A=]A gas source is a kind of thing. A gas source has a concentration called the contribution. The contribution of a gas source is usually 30.0ppm.[=0x000A=][=0x000A=]Room 2B contains a gas source called a spigot. The contribution of the spigot is 50.0ppm. Room 5A contains a gas source.[=0x000A=][=0x000A=]A gas sink is a kind of thing. A gas sink has a concentration called the contribution. The contribution of a gas sink is usually 30.0ppm.[=0x000A=][=0x000A=]Room 5E contains a gas sink called a fan. The contribution of the fan is 80.0ppm.[=0x000A=][=0x000A=]The first diffusion rule (this is the sources and sinks rule):[=0x000A=][=0x0009=]follow the sources rule;[=0x000A=][=0x0009=]follow the sinks rule.[=0x000A=][=0x000A=]This is the sinks rule:[=0x000A=][=0x0009=]repeat with item running through gas sinks:[=0x000A=][=0x0009=][=0x0009=]let space be the location of the item;[=0x000A=][=0x0009=][=0x0009=]decrease the former concentration of the space by the contribution of the item;[=0x000A=][=0x0009=][=0x0009=]if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.[=0x000A=][=0x000A=]This is the sources rule:[=0x000A=][=0x0009=]repeat with second item running through gas sources:[=0x000A=][=0x0009=][=0x0009=]let space be the location of the second item;[=0x000A=][=0x0009=][=0x0009=]increase the former concentration of the space by the contribution of the second item;[=0x000A=][=0x0009=][=0x0009=]if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.[=0x000A=][=0x000A=]Test me with [=0x0022=]z / z / z / z / z / z / z / z[=0x0022=].[=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Lethal Concentration&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31988" -->
<a id="c31988"></a><blockquote class="code"><p class="quoted">
A concentration is a kind of value. 200.9ppm specifies concentration. 200.9 ppm specifies concentration.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31989" -->
<a id="c31989"></a><blockquote class="code"><p class="quoted">
A room has a concentration called current concentration. A room has a concentration called former concentration.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31990" -->
<a id="c31990"></a><blockquote class="code"><p class="quoted">
Probability inverse is a number that varies. [This is expressed as an inverse of the actual probability of diffusion from one room to another, to avoid error.] Probability inverse is 20. [That is, any given molecule of gas has a 5% chance of leaving by a given doorway at any given minute. Probability inverse should never drop below 10, the maximum number of exits from the room.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31991" -->
<a id="c31991"></a><blockquote class="code"><p class="quoted">
Every turn:
<br />&#160;&#160;&#160;&#160;follow the diffusion rules.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31992" -->
<a id="c31992"></a><blockquote class="code"><p class="quoted">
The diffusion rules are a rulebook.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31993" -->
<a id="c31993"></a><blockquote class="code"><p class="quoted">
A diffusion rule (this is the gas movement rule):
<br />&#160;&#160;&#160;&#160;repeat with space running through rooms:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let sum be 0.0 ppm;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repeat with way running through directions:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let second space be the room way from the space;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if second space is a room:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let difference be the former concentration of the second space minus the former concentration of the space;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;increase sum by the difference;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let sum be sum divided by probability inverse;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now current concentration of the space is the former concentration of the space plus the sum.
</p></blockquote>
<!-- END CODE -->
<p>A technical note: it would be possible to write &quot;repeat with space running through rooms... repeat with second space running through rooms adjacent to the space&quot; instead, but in practice this loops through all the rooms * all the rooms again * all the directions (to determine adjacency). Phrasing the loop this way omits the second multiplier. For a map of 25 rooms, this means that the loop runs 25 times faster than it would otherwise, and of course for a larger map the effect would be even more dramatic.</p>
<!-- START CODE "c31994" -->
<a id="c31994"></a><blockquote class="code"><p class="quoted">
A diffusion rule (this is the resetting concentration rule):
<br />&#160;&#160;&#160;&#160;repeat with space running through rooms:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;now the former concentration of the space is the current concentration of the space.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31995" -->
<a id="c31995"></a><blockquote class="code"><p class="quoted">
The last diffusion rule (this is the lethal dosage rule):
<br />&#160;&#160;&#160;&#160;if the current concentration of the location is greater than LC50:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;The concentration in the air overpowers you...&quot;;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end the story;
<br />&#160;&#160;&#160;&#160;otherwise:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the current concentration of the location is greater than TLV-STEL:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;say &quot;You feel extremely uncomfortable in this environment.&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31996" -->
<a id="c31996"></a><blockquote class="code"><p class="quoted">
Instead of doing something when the current concentration of the location is greater than TLV-STEL:
<br />&#160;&#160;&#160;&#160;if going, continue the action;
<br />&#160;&#160;&#160;&#160;say &quot;You can't work in this environment: your eyes and nose sting and it hurts to breathe.&quot;
</p></blockquote>
<!-- END CODE -->
<p>And, for testing purposes, a square grid of rooms:</p>
<!-- START CODE "c31997" -->
<a id="c31997"></a><blockquote class="code"><p class="quoted">
Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31998" -->
<a id="c31998"></a><blockquote class="code"><p class="quoted">
Room 2A is south of room 1A and west of Room 2B. Room 2B is west of Room 2C and south of Room 1B. Room 2C is west of Room 2D and south of Room 1C. Room 2D is west of Room 2E and south of Room 1D. Room 2E is south of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c31999" -->
<a id="c31999"></a><blockquote class="code"><p class="quoted">
Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C and south of Room 2B. Room 3C is west of Room 3D and south of Room 2C. Room 3D is west of Room 3E and south of Room 2D. Room 3E is south of Room 2E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32000" -->
<a id="c32000"></a><blockquote class="code"><p class="quoted">
Room 4A is south of room 3A and west of Room 4B. Room 4B is west of Room 4C and south of Room 3B. Room 4C is west of Room 4D and south of Room 3C. Room 4D is west of Room 4E and south of Room 3D. Room 4E is south of Room 3E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32001" -->
<a id="c32001"></a><blockquote class="code"><p class="quoted">
Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32002" -->
<a id="c32002"></a><blockquote class="code"><p class="quoted">
The former concentration of room 3C is 800.0 ppm.
</p></blockquote>
<!-- END CODE -->
<p>For variety of testing, here is another room set-up, this time with some corridors and walls within; uncommenting it, and commenting out the connected grid, will let us explore what would happen in alternative cases, to prove to ourselves that the model works consistently.</p>
<!-- START CODE "c32003" -->
<a id="c32003"></a><blockquote class="code"><p class="quoted">
[Room 1A is west of Room 1B. Room 1B is west of Room 1C. Room 1C is west of Room 1D. Room 1D is west of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32004" -->
<a id="c32004"></a><blockquote class="code"><p class="quoted">
Room 2A is west of Room 2B. Room 2B is west of Room 2C. Room 2C is west of Room 2D. Room 2D is west of Room 2E. Room 2E is south of Room 1E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32005" -->
<a id="c32005"></a><blockquote class="code"><p class="quoted">
Room 3A is south of room 2A and west of Room 3B. Room 3B is west of Room 3C. Room 3C is west of Room 3D. Room 3D is west of Room 3E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32006" -->
<a id="c32006"></a><blockquote class="code"><p class="quoted">
Room 4A is west of Room 4B. Room 4B is west of Room 4C. Room 4C is west of Room 4D. Room 4D is west of Room 4E. Room 4E is south of Room 3E.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32007" -->
<a id="c32007"></a><blockquote class="code"><p class="quoted">
Room 5A is south of room 4A and west of Room 5B. Room 5B is west of Room 5C and south of Room 4B. Room 5C is west of Room 5D and south of Room 4C. Room 5D is west of Room 5E and south of Room 4D. Room 5E is south of Room 4E.]
</p></blockquote>
<!-- END CODE -->
<p>For the sake at least of seeing what's going on in the example, let's also provide the player with the means to view the gas diffusion graphically:</p>
<!-- START CODE "c32008" -->
<a id="c32008"></a><blockquote class="code"><p class="quoted">
The status grid is a device carried by the player. The status grid is switched on.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32009" -->
<a id="c32009"></a><blockquote class="code"><p class="quoted">
Every turn:
<br />&#160;&#160;&#160;&#160;try examining the grid.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32010" -->
<a id="c32010"></a><blockquote class="code"><p class="quoted">
Instead of examining the status grid:
<br />&#160;&#160;&#160;&#160;say &quot;[fixed letter spacing][bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 1A]|[state of room 1B]|[state of room 1C]|[state of room 1D]|[state of room 1E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 2A]|[state of room 2B]|[state of room 2C]|[state of room 2D]|[state of room 2E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 3A]|[state of room 3B]|[state of room 3C]|[state of room 3D]|[state of room 3E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 4A]|[state of room 4B]|[state of room 4C]|[state of room 4D]|[state of room 4E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;|[state of room 5A]|[state of room 5B]|[state of room 5C]|[state of room 5D]|[state of room 5E]|[line break]&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;[bar][variable letter spacing][line break]&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32011" -->
<a id="c32011"></a><blockquote class="code"><p class="quoted">
To say bar:
<br />&#160;&#160;&#160;&#160;say &quot;----------------------------------------------&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32012" -->
<a id="c32012"></a><blockquote class="code"><p class="quoted">
TLV is a concentration that varies. TLV is 30.0ppm. [Long-term exposure maximum, safe for 8 hours a day.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32013" -->
<a id="c32013"></a><blockquote class="code"><p class="quoted">
TLV-STEL is a concentration that varies. TLV-STEL is 50.0ppm. [Short-term exposure maximum, safe for fifteen minutes max.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32014" -->
<a id="c32014"></a><blockquote class="code"><p class="quoted">
TLV-C is a concentration that varies. TLV-C is 150.0ppm. [Absolute exposure ceiling.]
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32015" -->
<a id="c32015"></a><blockquote class="code"><p class="quoted">
LC50 is a concentration that varies. LC50 is 300.0ppm. [Concentration at which 50 percent of test subjects die of exposure, usually expressed in terms of time and body weight; in our LC50 these are factored in for the player's weight for one minute.]
</p></blockquote>
<!-- END CODE -->
<p>The values set for these would depend on the type of poisonous gas in question; we'd want to adjust appropriately.</p>
<!-- START CODE "c32016" -->
<a id="c32016"></a><blockquote class="code"><p class="quoted">
To say state of (space - a room):
<br />&#160;&#160;&#160;&#160;if the space is the location, say bold type;
<br />&#160;&#160;&#160;&#160;if current concentration of space is less than 10.0ppm, say &quot; &quot;;
<br />&#160;&#160;&#160;&#160;if current concentration of space is less than 100.0ppm, say &quot; &quot;;
<br />&#160;&#160;&#160;&#160;say current concentration of space;
<br />&#160;&#160;&#160;&#160;say roman type.
</p></blockquote>
<!-- END CODE -->
<p>Now, in theory we might also want to account for sources and sinks, items that either inject poisonous gas into the environment or remove it again. For simplicity, we will assume that these contributions can also be calculated in ppm and that the total number of inert and poisonous gas molecules in a room never changes (so if poison gas molecules are added, an equal number of inert molecules are removed). If room pressure were able to change, our model would have to be improved, so let us assume for now that that never happens. We want this sink/source business to calculate before any other portion of the diffusion rulebook, so set it as a first diffusion rule.</p>
<!-- START CODE "c32017" -->
<a id="c32017"></a><blockquote class="code"><p class="quoted">
A gas source is a kind of thing. A gas source has a concentration called the contribution. The contribution of a gas source is usually 30.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32018" -->
<a id="c32018"></a><blockquote class="code"><p class="quoted">
Room 2B contains a gas source called a spigot. The contribution of the spigot is 50.0ppm. Room 5A contains a gas source.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32019" -->
<a id="c32019"></a><blockquote class="code"><p class="quoted">
A gas sink is a kind of thing. A gas sink has a concentration called the contribution. The contribution of a gas sink is usually 30.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32020" -->
<a id="c32020"></a><blockquote class="code"><p class="quoted">
Room 5E contains a gas sink called a fan. The contribution of the fan is 80.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32021" -->
<a id="c32021"></a><blockquote class="code"><p class="quoted">
The first diffusion rule (this is the sources and sinks rule):
<br />&#160;&#160;&#160;&#160;follow the sources rule;
<br />&#160;&#160;&#160;&#160;follow the sinks rule.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32022" -->
<a id="c32022"></a><blockquote class="code"><p class="quoted">
This is the sinks rule:
<br />&#160;&#160;&#160;&#160;repeat with item running through gas sinks:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let space be the location of the item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;decrease the former concentration of the space by the contribution of the item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32023" -->
<a id="c32023"></a><blockquote class="code"><p class="quoted">
This is the sources rule:
<br />&#160;&#160;&#160;&#160;repeat with second item running through gas sources:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let space be the location of the second item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;increase the former concentration of the space by the contribution of the second item;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the former concentration of the space is less than 0.0ppm, now the former concentration of the space is 0.0ppm.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c32024" -->
<a id="c32024"></a><blockquote class="code"><p class="quoted">
Test me with &quot;z / z / z / z / z / z / z / z&quot;.
</p></blockquote>
<!-- END CODE -->
</div>
<!-- EXAMPLE END -->
<div class="egovalforxref overstruckimage">
<a  href="ex276.html#e276"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e71"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="Rex71.html#e71" class="eglink"><b>74</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="Rex71.html#e71" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Only You...</span></b></a><br />Smoke which spreads through the rooms of the map, but only every other turn.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="ex71.html#e71"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e18"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="Rex18.html#e18" class="eglink"><b>257</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="Rex18.html#e18" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Lethal Concentration 2</span></b></a><br />Poisonous gas again, only this time it sinks.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="ex18.html#e18"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
</body>
</html>
