<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Generated by indoc on 29 May 2018 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_RB.css" rel="stylesheet" type="text/css" />
<title>6.17. Clarification and Correction</title>
<script type="text/javascript">
    function showExtra(id, imid) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
            document.getElementById(imid).src = 'Documentation/Images/extra.png';
        } else {
            document.getElementById(id).style.display = 'block';
            document.getElementById(imid).src = 'Documentation/Images/extraclose.png';
        }
    }
    function onLoaded() {
        if (window.location.hash) {
            var hash = window.location.hash.substring(2);
            if (hash.search("_") >= 0) {
                var res = hash.split("_");
                showExample("example"+res[1]);
            } else {
                showExample("example"+hash);
            }
        }
    }
    window.onload=onLoaded;
    function showExample(id) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).style.display = 'block';
        }
    }
    function openExtra(id, imid) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(imid).src = 'Documentation/Images/extraclose.png';
    }
    function closeExtra(id, imid) {
        document.getElementById(id).style.display = 'none';
        document.getElementById(imid).src = 'Documentation/Images/extra.png';
    }
</script>
</head>
<body class="paper papertint"><script language="JavaScript">
function pasteCode(code) {
    var myProject = window.Project;

    myProject.selectView('source');
    myProject.pasteCode(code);
}
</script>
<script language="JavaScript">
function createNewProject(code, title) {
    var myProject = window.Project;

    myProject.createNewProject(title, code);
}
</script>
<p class="sectionheading">ยง6.17. Clarification and Correction</p>
<p>Some commands and some objects raise special challenges when it comes to working out the player's intention.</p>
<p>Sometimes this can be done with good rules about the assumptions Inform should make. <span class="boldface">Alpaca Farm</span> demonstrates a USE command, always a challenge because USE can mean very different actions with different items.</p>
<p>There are also times when we need to ask the player for more information. <span class="boldface">Apples</span> demonstrates how sensibly to use properties to disambiguate between similar objects, while <span class="boldface">Walls and Noses</span> rephrases the disambiguation question when special objects are involved: examining one of the walls of the room will make the story ask &quot;In which direction?&quot; and EXAMINE NOSE will lead to &quot;Whose nose do you mean, Frederica's, Betty's, Wilma's or your own?&quot;</p>
<p>At other times, the player types something that is wrong in a predictable way: for instance, we might want to remove all the &quot;with...&quot; phrases from commands like</p>
<!-- START CODE "c23692" -->
<a id="c23692"></a><blockquote class="code"><p class="quoted">
HIT DOOR WITH FIST
<br />KICK DRAGON WITH FOOT
<br />LOOK WEST WITH EYES
</p></blockquote>
<!-- END CODE -->
<p>and merely parse the remainder of the command. (That last command may be unlikely, but novice players do quite often type commands that refer unnecessarily to body parts.) <span class="boldface">Cave-troll</span> demonstrates how.</p>
<p><span class="boldface">WXPQ</span> demonstrates how to modify the error message the parser gives in response to a command it doesn't understand; this particular example focuses on the &quot;That noun doesn't make sense in this context&quot; message that arises from using the &quot;[any thing]&quot; or &quot;[any room]&quot; tokens, but the techniques could be adapted to handling other parser errors as well.</p>
<p>For catching typing errors, Cedric Knight's extension Mistype may also be of use: it provides an automatic typo-correction function that the player can turn on or off.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="RB_6_1.html" class="standardlink"><img alt="arrow-up.png" src="Documentation/Images/arrow-up.png" /></a></td><td><a href="RB_6_1.html" class="standardlink">Start of Chapter 6: Commands</a></td></tr>
<tr><td class="roadsigndirection"><a href="RB_6_16.html" class="standardlink"><img alt="arrow-left.png" src="Documentation/Images/arrow-left.png" /></a></td><td><a href="RB_6_16.html" class="standardlink">Back to ยง6.16. Alternate Default Messages</a></td></tr>
<tr><td class="roadsigndirection"><a href="RB_6_18.html" class="standardlink"><img alt="arrow-right.png" src="Documentation/Images/arrow-right.png" /></a></td><td><a href="RB_6_18.html" class="standardlink">Onward to ยง6.18. Alternatives To Standard Parsing</a></td></tr>
</table><hr />
</div>
<div class="bookexamples">
<p class="chapterheading"></p><a id="e204"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="Rex204.html#e204" class="eglink"><b>290</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="Rex204.html#e204" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Alpaca Farm</span></b></a><br />A generic USE action which behaves sensibly with a range of different objects.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="ex204.html#e204"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e42"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="Rex42.html#e42" class="eglink"><b>368</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="Rex42.html#e42" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Apples</span></b></a><br />Prompting the player on how to disambiguate otherwise similar objects.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="ex42.html#e42"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e444"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="Rex444.html#e444" class="eglink"><b>380</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="Rex444.html#e444" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">WXPQ</span></b></a><br />Creating a more sensible parser error than "that noun did not make sense in this context".</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="ex444.html#e444"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e262"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="Rex262.html#e262" class="eglink"><b>370</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="Rex262.html#e262" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Walls and Noses</span></b></a><br />Responding to "EXAMINE WALL" with "In which direction?", and to "EXAMINE NOSE" with "Whose nose do you mean, Frederica's, Betty's, Wilma's or your own?"</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="ex262.html#e262"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e119"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<!-- EXAMPLE START -->
<a href="RB_6_17.html#e119" class="eglink"><b>424</b></a></div>
<div class="egpanel" id="example119">
<p>Novice players of interactive fiction, unfamiliar with its conventions, will often try to add extra phrases to a command that the game cannot properly parse: HIT DOOR WITH FIST, for instance, instead of HIT DOOR.</p>
<p>While we can deal with some of these instances by expanding our range of actions, at some point it becomes impossible to account for all the possible prepositional phrases that the player might want to tack on. So what do we do if we want to handle those appended bits of text sensibly?</p>
<p>We could go through and remove any piece of text containing &quot;with ...&quot; from the end of a player's command; the problem with that is that it overzealously lops off the ends of valid commands like UNLOCK DOOR WITH KEY, as well. So clearly we don't want to do this as part of the &quot;After reading a command...&quot; stage.</p>
<p>A better time to cut off the offending text is right before issuing a parser error. At that point, Inform has already determined that it definitely cannot parse the instruction as given, so we know that there's something wrong with it.</p>
<p>The next problem, though, is that after we've edited the player's text we want to feed the corrected version back to Inform and try once more to interpret it.</p>
<p>This is where we have a valid reason to write a new &quot;rule for reading a command&quot;. We will tell Inform that when we have just corrected the player's input to something new, it should not ask for a new command (by printing a prompt and waiting for another line of input); it should instead paste our stored corrected command back into &quot;the player's command&quot; and proceed as though that new text had just been typed.</p>
<p>Thanks to John Clemens for the specifics of the implementation.</p>
<!-- START CODE "c27307" -->
<a id="c27307"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Cave-troll[=0x0022=] by JDC[=0x000A=][=0x000A=]Section 1 - The Mechanism[=0x000A=][=0x000A=]The last command is a text that varies.[=0x000A=][=0x000A=]The parser error flag is a truth state that varies. The parser error flag is false.[=0x000A=][=0x000A=]Rule for printing a parser error when the latest parser error is the only understood as far as error and the player[=0x0027=]s command matches the text [=0x0022=]with[=0x0022=]:[=0x000A=][=0x0009=]now the last command is the player[=0x0027=]s command;[=0x000A=][=0x0009=]now the parser error flag is true;[=0x000A=][=0x0009=]let n be [=0x0022=][the player[=0x0027=]s command][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=].* with (.*)[=0x0022=] in n with [=0x0022=]with [=0x005C=]1[=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=](ignoring the unnecessary words [=0x0027=][n][=0x0027=])[line break][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=]with .*[=0x0022=] in the last command with [=0x0022=][=0x0022=].[=0x000A=][=0x000A=]Rule for reading a command when the parser error flag is true:[=0x000A=][=0x0009=]now the parser error flag is false;[=0x000A=][=0x0009=]change the text of the player[=0x0027=]s command to the last command.[=0x000A=][=0x000A=]Section 2 - The Scenario[=0x000A=][=0x000A=]The Cave is a room.[=0x000A=][=0x000A=]The troll is a man in the cave.[=0x000A=][=0x000A=]The player carries a sword.[=0x000A=][=0x000A=]The chest is a locked lockable container in the cave.[=0x000A=][=0x000A=]Test me with [=0x0022=]attack troll with sword / unlock chest with sword / attack troll as a test[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Cave-troll&quot; by JDC
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27308" -->
<a id="c27308"></a><blockquote class="code"><p class="quoted">
Section 1 - The Mechanism
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27309" -->
<a id="c27309"></a><blockquote class="code"><p class="quoted">
The last command is a text that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27310" -->
<a id="c27310"></a><blockquote class="code"><p class="quoted">
The parser error flag is a truth state that varies. The parser error flag is false.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27311" -->
<a id="c27311"></a><blockquote class="code"><p class="quoted">
Rule for printing a parser error when the latest parser error is the only understood as far as error and the player's command matches the text &quot;with&quot;:
<br />&#160;&#160;&#160;&#160;now the last command is the player's command;
<br />&#160;&#160;&#160;&#160;now the parser error flag is true;
<br />&#160;&#160;&#160;&#160;let n be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;.* with (.*)&quot; in n with &quot;with \1&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;(ignoring the unnecessary words '[n]')[line break]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;with .*&quot; in the last command with &quot;&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27312" -->
<a id="c27312"></a><blockquote class="code"><p class="quoted">
Rule for reading a command when the parser error flag is true:
<br />&#160;&#160;&#160;&#160;now the parser error flag is false;
<br />&#160;&#160;&#160;&#160;change the text of the player's command to the last command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27313" -->
<a id="c27313"></a><blockquote class="code"><p class="quoted">
Section 2 - The Scenario
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27314" -->
<a id="c27314"></a><blockquote class="code"><p class="quoted">
The Cave is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27315" -->
<a id="c27315"></a><blockquote class="code"><p class="quoted">
The troll is a man in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27316" -->
<a id="c27316"></a><blockquote class="code"><p class="quoted">
The player carries a sword.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27317" -->
<a id="c27317"></a><blockquote class="code"><p class="quoted">
The chest is a locked lockable container in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27318" -->
<a id="c27318"></a><blockquote class="code"><p class="quoted">
Test me with &quot;attack troll with sword / unlock chest with sword / attack troll as a test&quot;.
</p></blockquote>
<!-- END CODE -->
<p>A caveat about using this method in a larger game: &quot;parser error flag&quot; will not automatically control the behavior of any rules we might have written for Before reading a command... or After reading a command..., so they may now fire at inappropriate times. It is a good idea to check for parser error flag in those rules as well.</p>
</div>
<!-- EXAMPLE END -->
<!-- EXAMPLE START -->
</td><td class="egnamecell"><p class="egcuetext"><a href="RB_6_17.html#e119" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner"><b>Example</b></span><span class="egname">Cave-troll</span></b></a><br />Determining that the command the player typed is invalid, editing it, and re-examining it to see whether it now reads correctly.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egpanel" id="example119">
<p>Novice players of interactive fiction, unfamiliar with its conventions, will often try to add extra phrases to a command that the game cannot properly parse: HIT DOOR WITH FIST, for instance, instead of HIT DOOR.</p>
<p>While we can deal with some of these instances by expanding our range of actions, at some point it becomes impossible to account for all the possible prepositional phrases that the player might want to tack on. So what do we do if we want to handle those appended bits of text sensibly?</p>
<p>We could go through and remove any piece of text containing &quot;with ...&quot; from the end of a player's command; the problem with that is that it overzealously lops off the ends of valid commands like UNLOCK DOOR WITH KEY, as well. So clearly we don't want to do this as part of the &quot;After reading a command...&quot; stage.</p>
<p>A better time to cut off the offending text is right before issuing a parser error. At that point, Inform has already determined that it definitely cannot parse the instruction as given, so we know that there's something wrong with it.</p>
<p>The next problem, though, is that after we've edited the player's text we want to feed the corrected version back to Inform and try once more to interpret it.</p>
<p>This is where we have a valid reason to write a new &quot;rule for reading a command&quot;. We will tell Inform that when we have just corrected the player's input to something new, it should not ask for a new command (by printing a prompt and waiting for another line of input); it should instead paste our stored corrected command back into &quot;the player's command&quot; and proceed as though that new text had just been typed.</p>
<p>Thanks to John Clemens for the specifics of the implementation.</p>
<!-- START CODE "c27319" -->
<a id="c27319"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Cave-troll[=0x0022=] by JDC[=0x000A=][=0x000A=]Section 1 - The Mechanism[=0x000A=][=0x000A=]The last command is a text that varies.[=0x000A=][=0x000A=]The parser error flag is a truth state that varies. The parser error flag is false.[=0x000A=][=0x000A=]Rule for printing a parser error when the latest parser error is the only understood as far as error and the player[=0x0027=]s command matches the text [=0x0022=]with[=0x0022=]:[=0x000A=][=0x0009=]now the last command is the player[=0x0027=]s command;[=0x000A=][=0x0009=]now the parser error flag is true;[=0x000A=][=0x0009=]let n be [=0x0022=][the player[=0x0027=]s command][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=].* with (.*)[=0x0022=] in n with [=0x0022=]with [=0x005C=]1[=0x0022=];[=0x000A=][=0x0009=]say [=0x0022=](ignoring the unnecessary words [=0x0027=][n][=0x0027=])[line break][=0x0022=];[=0x000A=][=0x0009=]replace the regular expression [=0x0022=]with .*[=0x0022=] in the last command with [=0x0022=][=0x0022=].[=0x000A=][=0x000A=]Rule for reading a command when the parser error flag is true:[=0x000A=][=0x0009=]now the parser error flag is false;[=0x000A=][=0x0009=]change the text of the player[=0x0027=]s command to the last command.[=0x000A=][=0x000A=]Section 2 - The Scenario[=0x000A=][=0x000A=]The Cave is a room.[=0x000A=][=0x000A=]The troll is a man in the cave.[=0x000A=][=0x000A=]The player carries a sword.[=0x000A=][=0x000A=]The chest is a locked lockable container in the cave.[=0x000A=][=0x000A=]Test me with [=0x0022=]attack troll with sword / unlock chest with sword / attack troll as a test[=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Cave-troll&quot; by JDC
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27320" -->
<a id="c27320"></a><blockquote class="code"><p class="quoted">
Section 1 - The Mechanism
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27321" -->
<a id="c27321"></a><blockquote class="code"><p class="quoted">
The last command is a text that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27322" -->
<a id="c27322"></a><blockquote class="code"><p class="quoted">
The parser error flag is a truth state that varies. The parser error flag is false.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27323" -->
<a id="c27323"></a><blockquote class="code"><p class="quoted">
Rule for printing a parser error when the latest parser error is the only understood as far as error and the player's command matches the text &quot;with&quot;:
<br />&#160;&#160;&#160;&#160;now the last command is the player's command;
<br />&#160;&#160;&#160;&#160;now the parser error flag is true;
<br />&#160;&#160;&#160;&#160;let n be &quot;[the player's command]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;.* with (.*)&quot; in n with &quot;with \1&quot;;
<br />&#160;&#160;&#160;&#160;say &quot;(ignoring the unnecessary words '[n]')[line break]&quot;;
<br />&#160;&#160;&#160;&#160;replace the regular expression &quot;with .*&quot; in the last command with &quot;&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27324" -->
<a id="c27324"></a><blockquote class="code"><p class="quoted">
Rule for reading a command when the parser error flag is true:
<br />&#160;&#160;&#160;&#160;now the parser error flag is false;
<br />&#160;&#160;&#160;&#160;change the text of the player's command to the last command.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27325" -->
<a id="c27325"></a><blockquote class="code"><p class="quoted">
Section 2 - The Scenario
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27326" -->
<a id="c27326"></a><blockquote class="code"><p class="quoted">
The Cave is a room.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27327" -->
<a id="c27327"></a><blockquote class="code"><p class="quoted">
The troll is a man in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27328" -->
<a id="c27328"></a><blockquote class="code"><p class="quoted">
The player carries a sword.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27329" -->
<a id="c27329"></a><blockquote class="code"><p class="quoted">
The chest is a locked lockable container in the cave.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c27330" -->
<a id="c27330"></a><blockquote class="code"><p class="quoted">
Test me with &quot;attack troll with sword / unlock chest with sword / attack troll as a test&quot;.
</p></blockquote>
<!-- END CODE -->
<p>A caveat about using this method in a larger game: &quot;parser error flag&quot; will not automatically control the behavior of any rules we might have written for Before reading a command... or After reading a command..., so they may now fire at inappropriate times. It is a good idea to check for parser error flag in those rules as well.</p>
</div>
<!-- EXAMPLE END -->
<div class="egovalforxref overstruckimage">
<a  href="ex119.html#e119"><i>WI</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
</body>
</html>
