<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Generated by indoc on 29 May 2018 -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="indoc_WI.css" rel="stylesheet" type="text/css" />
<title>23.13. Writing and reading tables to external files</title>
<script type="text/javascript">
    function showExtra(id, imid) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
            document.getElementById(imid).src = 'Documentation/Images/extra.png';
        } else {
            document.getElementById(id).style.display = 'block';
            document.getElementById(imid).src = 'Documentation/Images/extraclose.png';
        }
    }
    function onLoaded() {
        if (window.location.hash) {
            var hash = window.location.hash.substring(2);
            if (hash.search("_") >= 0) {
                var res = hash.split("_");
                showExample("example"+res[1]);
            } else {
                showExample("example"+hash);
            }
        }
    }
    window.onload=onLoaded;
    function showExample(id) {
        if (document.getElementById(id).style.display == 'block') {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).style.display = 'block';
        }
    }
    function openExtra(id, imid) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(imid).src = 'Documentation/Images/extraclose.png';
    }
    function closeExtra(id, imid) {
        document.getElementById(id).style.display = 'none';
        document.getElementById(imid).src = 'Documentation/Images/extra.png';
    }
</script>
</head>
<body class="paper papertint"><script language="JavaScript">
function pasteCode(code) {
    var myProject = window.Project;

    myProject.selectView('source');
    myProject.pasteCode(code);
}
</script>
<script language="JavaScript">
function createNewProject(code, title) {
    var myProject = window.Project;

    myProject.createNewProject(title, code);
}
</script>
<p class="sectionheading">ยง23.13. Writing and reading tables to external files</p>
<p>The main use for files is to store and retrieve data, and the most flexible form of data used by Inform is the Table, so facilities are provided which make it as easy as possible to write and read the contents of a table to files. If so, the file must contain just one single table: so to write multiple tables, we need to write multiple files, one for each.</p>
<p>To save the contents of a table to a file, we use the phrase:</p>
<!-- START PHRASE "defn369" -->
<div class="definition"><a id="defn369"></a><p class="defnprototype"><b>write </b>(external file)<b> from </b>(table name)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_writetable -->

<p>This phrase causes the entire contents of the given table to be written out to the given file. Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c1919" -->
<a id="c1919"></a><blockquote class="code"><p class="quoted">
write File of Glaciation Data from the Table of Antarctic Reserves
</p></blockquote>
<!-- END CODE -->
<p>Any blank rows in the table are automatically moved to the bottom, and only the non-blank rows are written.</p>

<!-- end definition -->
</div>

<p>To load a file back into a table,</p>
<!-- START PHRASE "defn370" -->
<div class="definition"><a id="defn370"></a><p class="defnprototype"><b>read </b>(external file)<b> into </b>(table name)<b></b></p>
<!-- END PHRASE -->
<!-- definition of ph_readtable -->

<p>This phrase causes the entire contents of the given table to be read in from the given file. Note that files must have been declared, and must be referred to by their Inform names, not by textual filenames. Example:</p>
<!-- START CODE "c1920" -->
<a id="c1920"></a><blockquote class="code"><p class="quoted">
read File of Glaciation Data into the Table of Antarctic Reserves
</p></blockquote>
<!-- END CODE -->
<p>Any rows left spare at the foot of the table are automatically blanked. On the other hand if the file is too large to fit into the table - with too many columns or too many rows - a run-time problem is produced.</p>

<!-- end definition -->
</div>

<p>We can check if a file already exists using:</p>
<!-- START PHRASE "defn371" -->
<div class="definition"><a id="defn371"></a><p class="defnprototype"><b>if </b>(external file)<b> exists:</b></p>
<!-- END PHRASE -->
<!-- definition of ph_fileexists -->

<p>This condition is true if the file-system used by the player appears to contain a file with the right name. For example, if we declared:</p>
<!-- START CODE "c1921" -->
<a id="c1921"></a><blockquote class="code"><p class="quoted">
The binary File of Glaciation Data is called &quot;icedata&quot;.
</p></blockquote>
<!-- END CODE -->
<p>and then tested</p>
<!-- START CODE "c1922" -->
<a id="c1922"></a><blockquote class="code"><p class="quoted">
if the File of Glaciation Data exists, ...
</p></blockquote>
<!-- END CODE -->
<p>then Inform would search for a file called &quot;icedata&quot;. (The arrangements for where this might be stored, and its filename extension, vary from platform to platform.)</p>

<!-- end definition -->
</div>

<p>One unfortunate restriction must be kept in mind. Some of what is stored in tables is solid information whose meaning never changes: the number 342, for instance, means the same to everyone. But other information depends entirely on the current location of certain structures in memory - for instance, a rule is internally referred to by its memory location. This potentially changes each time Go or Replay is clicked, and so it is not safe to pass it from one copy to another, or from one project to another. The only tables which Inform allows us to write into files are those containing &quot;safe&quot; data: numbers, units, times of day and kinds of value with named alternatives. Scenes, rules or rulebooks, in particular, are not allowed.</p>
<hr />
<div class="roadsigns">
<table><tr><td class="roadsigndirection"><a href="WI_23_1.html" class="standardlink"><img alt="arrow-up.png" src="Documentation/Images/arrow-up.png" /></a></td><td><a href="WI_23_1.html" class="standardlink">Start of Chapter 23: Figures, Sounds and Files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23_12.html" class="standardlink"><img alt="arrow-left.png" src="Documentation/Images/arrow-left.png" /></a></td><td><a href="WI_23_12.html" class="standardlink">Back to ยง23.12. Declaring files</a></td></tr>
<tr><td class="roadsigndirection"><a href="WI_23_14.html" class="standardlink"><img alt="arrow-right.png" src="Documentation/Images/arrow-right.png" /></a></td><td><a href="WI_23_14.html" class="standardlink">Onward to ยง23.14. Writing, reading and appending text to files</a></td></tr>
</table><hr />
</div>
<div class="bookexamples">
<p class="chapterheading"></p><a id="e190"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="ex190.html#e190" class="eglink"><b>440</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="ex190.html#e190" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Alien Invasion Part 23</span></b></a><br />Keeping a preference file that could be loaded by any game in a series.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rex190.html#e190"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<a id="e352"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<!-- EXAMPLE START -->
<a href="WI_23_13.html#e352" class="eglink"><b>441</b></a></div>
<div class="egpanel" id="example352">
<p>A tradition among Nethack-like computer games of the old school is that a player's death in a given place leaves a ghost behind to haunt subsequent players. Information about past lives is sometimes stored in a &quot;bones file&quot;, and in this example we do exactly that, for a grievously unfair little dungeon.</p>
<p>To begin with, the labyrinth itself. We create a kind of value to remember possible means of death in these tunnels, and we assign a coordinate position in some grid to each location. (We do this because grid positions can safely be stored in tables saved out to external files, whereas room names cannot - they represent data which changes each time we amend the source.)</p>
<!-- START CODE "c18451" -->
<a id="c18451"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Labyrinth of Ghosts[=0x0022=][=0x000A=][=0x000A=]Use scoring.[=0x000A=][=0x000A=]A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.[=0x000A=][=0x000A=]A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.[=0x000A=][=0x000A=]The Gateway is a room. [=0x0022=]For the foolhardy adventurer, the perilous labyrinth lies north, east or south.[=0x0022=] The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. [=0x0022=]This partly fallen cave may perhaps extend further north.[=0x0022=] The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. [=0x0022=]No telling why this canyon is named after archery, but perhaps if you wait around you[=0x0027=]ll find out.[=0x0022=] The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.[=0x000A=][=0x000A=]Every turn when a random chance of 1 in 10 succeeds:[=0x000A=][=0x0009=]say [=0x0022=]A dwarf appears out of nowhere, and throws a nasty little knife.[=0x0022=];[=0x000A=][=0x0009=]have the player slain.[=0x000A=][=0x000A=][And as compensation for these hazards:][=0x000A=][=0x000A=]Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.[=0x000A=][=0x000A=]Table of Point Values[=0x000A=]item [=0x0009=]  [=0x0009=]score[=0x000A=]silver bars[=0x0009=]3[=0x000A=]platinum pyramid[=0x0009=]10[=0x000A=]emerald[=0x0009=]4[=0x000A=][=0x000A=]Report taking an item listed in the Table of Point Values:[=0x000A=][=0x0009=]increase the score by the score entry;[=0x000A=][=0x0009=]blank out the whole row.[=0x000A=][=0x000A=][We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.][=0x000A=][=0x000A=]Table of Ghostly Presences[=0x000A=]haunted position[=0x0009=]score at death[=0x0009=]turns at death[=0x0009=]manner of death[=0x0009=]sequence[=0x000A=]a grid location[=0x0009=]a number[=0x0009=]a number[=0x0009=]a demise[=0x0009=]a number[=0x000A=]with 19 blank rows.[=0x000A=][=0x000A=][As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.][=0x000A=][=0x000A=]The File of Ghosts is called [=0x0022=]ghosts[=0x0022=].[=0x000A=][=0x000A=]When play begins:[=0x000A=][=0x0009=]if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;[=0x000A=][=0x0009=]sort the Table of Ghostly Presences in sequence order.[=0x000A=][=0x000A=][How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...][=0x000A=][=0x000A=]After looking:[=0x000A=][=0x0009=]repeat through the Table of Ghostly Presences in reverse sequence order:[=0x000A=][=0x0009=][=0x0009=]if the haunted position entry is the coordinates of the location, say [=0x0022=]You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.[=0x0022=][=0x000A=][=0x000A=][(For instance, [=0x0022=]You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.[=0x0022=]) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)][=0x000A=][=0x000A=]To have the player (sticky end - a demise):[=0x000A=][=0x0009=]let the new sequence number be 0;[=0x000A=][=0x0009=]repeat through the Table of Ghostly Presences:[=0x000A=][=0x0009=][=0x0009=]let S be the sequence entry;[=0x000A=][=0x0009=][=0x0009=]if S is greater than the new sequence number, let the new sequence number be S;[=0x000A=][=0x0009=]increment the new sequence number;[=0x000A=][=0x0009=]if the number of blank rows in the Table of Ghostly Presences is 0:[=0x000A=][=0x0009=][=0x0009=]choose row 1 in the Table of Ghostly Presences;[=0x000A=][=0x0009=][=0x0009=]blank out the whole row;[=0x000A=][=0x0009=]choose a blank row in the Table of Ghostly Presences;[=0x000A=][=0x0009=]now the sequence entry is the new sequence number;[=0x000A=][=0x0009=]now the manner of death entry is the sticky end;[=0x000A=][=0x0009=]now the turns at death entry is the turn count;[=0x000A=][=0x0009=]now the score at death entry is the score;[=0x000A=][=0x0009=]now the haunted position entry is the coordinates of the location;[=0x000A=][=0x0009=]write the File of Ghosts from the Table of Ghostly Presences;[=0x000A=][=0x0009=]now the latest demise is the sticky end;[=0x000A=][=0x0009=]end the story saying [=0x0022=]You have been [latest demise][=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Labyrinth of Ghosts&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18452" -->
<a id="c18452"></a><blockquote class="code"><p class="quoted">
Use scoring.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18453" -->
<a id="c18453"></a><blockquote class="code"><p class="quoted">
A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18454" -->
<a id="c18454"></a><blockquote class="code"><p class="quoted">
A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18455" -->
<a id="c18455"></a><blockquote class="code"><p class="quoted">
The Gateway is a room. &quot;For the foolhardy adventurer, the perilous labyrinth lies north, east or south.&quot; The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. &quot;This partly fallen cave may perhaps extend further north.&quot; The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. &quot;No telling why this canyon is named after archery, but perhaps if you wait around you'll find out.&quot; The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18456" -->
<a id="c18456"></a><blockquote class="code"><p class="quoted">
Every turn when a random chance of 1 in 10 succeeds:
<br />&#160;&#160;&#160;&#160;say &quot;A dwarf appears out of nowhere, and throws a nasty little knife.&quot;;
<br />&#160;&#160;&#160;&#160;have the player slain.
</p></blockquote>
<!-- END CODE -->
<p>And as compensation for these hazards:</p>
<!-- START CODE "c18457" -->
<a id="c18457"></a><blockquote class="code"><p class="quoted">
Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18458" -->
<a id="c18458"></a><blockquote class="code"><p class="quoted">
Table of Point Values
<br />item 	  	score
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">silver bars</p></td><td class="quotedtablecell"><p class="quoted">3</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">platinum pyramid</p></td><td class="quotedtablecell"><p class="quoted">10</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">emerald</p></td><td class="quotedtablecell"><p class="quoted">4</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18459" -->
<a id="c18459"></a><blockquote class="code"><p class="quoted">
Report taking an item listed in the Table of Point Values:
<br />&#160;&#160;&#160;&#160;increase the score by the score entry;
<br />&#160;&#160;&#160;&#160;blank out the whole row.
</p></blockquote>
<!-- END CODE -->
<p>We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.</p>
<!-- START CODE "c18460" -->
<a id="c18460"></a><blockquote class="code"><p class="quoted">
Table of Ghostly Presences
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">haunted position</p></td><td class="quotedtablecell"><p class="quoted">score at death</p></td><td class="quotedtablecell"><p class="quoted">turns at death</p></td><td class="quotedtablecell"><p class="quoted">manner of death</p></td><td class="quotedtablecell"><p class="quoted">sequence</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">a grid location</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a demise</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">with 19 blank rows.</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.</p>
<!-- START CODE "c18461" -->
<a id="c18461"></a><blockquote class="code"><p class="quoted">
The File of Ghosts is called &quot;ghosts&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18462" -->
<a id="c18462"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;sort the Table of Ghostly Presences in sequence order.
</p></blockquote>
<!-- END CODE -->
<p>How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...</p>
<!-- START CODE "c18463" -->
<a id="c18463"></a><blockquote class="code"><p class="quoted">
After looking:
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences in reverse sequence order:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the haunted position entry is the coordinates of the location, say &quot;You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.&quot;
</p></blockquote>
<!-- END CODE -->
<p>(For instance, &quot;You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.&quot;) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)</p>
<!-- START CODE "c18464" -->
<a id="c18464"></a><blockquote class="code"><p class="quoted">
To have the player (sticky end - a demise):
<br />&#160;&#160;&#160;&#160;let the new sequence number be 0;
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let S be the sequence entry;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if S is greater than the new sequence number, let the new sequence number be S;
<br />&#160;&#160;&#160;&#160;increment the new sequence number;
<br />&#160;&#160;&#160;&#160;if the number of blank rows in the Table of Ghostly Presences is 0:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;choose row 1 in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blank out the whole row;
<br />&#160;&#160;&#160;&#160;choose a blank row in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the sequence entry is the new sequence number;
<br />&#160;&#160;&#160;&#160;now the manner of death entry is the sticky end;
<br />&#160;&#160;&#160;&#160;now the turns at death entry is the turn count;
<br />&#160;&#160;&#160;&#160;now the score at death entry is the score;
<br />&#160;&#160;&#160;&#160;now the haunted position entry is the coordinates of the location;
<br />&#160;&#160;&#160;&#160;write the File of Ghosts from the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the latest demise is the sticky end;
<br />&#160;&#160;&#160;&#160;end the story saying &quot;You have been [latest demise]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Strictly speaking we ought to worry that after 2,147,483,647 deaths, the sequence numbers would grow too large to store in a single value, and then the sequence of ghosts will be erratic. But it seems unlikely that anyone will play this example 2.1 billion times.</p>
</div>
<!-- EXAMPLE END -->
<!-- EXAMPLE START -->
</td><td class="egnamecell"><p class="egcuetext"><a href="WI_23_13.html#e352" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner"><b>Example</b></span><span class="egname">Labyrinth of Ghosts</span></b></a><br />Remembering the fates of all previous explorers of the labyrinth.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egpanel" id="example352">
<p>A tradition among Nethack-like computer games of the old school is that a player's death in a given place leaves a ghost behind to haunt subsequent players. Information about past lives is sometimes stored in a &quot;bones file&quot;, and in this example we do exactly that, for a grievously unfair little dungeon.</p>
<p>To begin with, the labyrinth itself. We create a kind of value to remember possible means of death in these tunnels, and we assign a coordinate position in some grid to each location. (We do this because grid positions can safely be stored in tables saved out to external files, whereas room names cannot - they represent data which changes each time we amend the source.)</p>
<!-- START CODE "c18465" -->
<a id="c18465"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Labyrinth of Ghosts[=0x0022=][=0x000A=][=0x000A=]Use scoring.[=0x000A=][=0x000A=]A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.[=0x000A=][=0x000A=]A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.[=0x000A=][=0x000A=]The Gateway is a room. [=0x0022=]For the foolhardy adventurer, the perilous labyrinth lies north, east or south.[=0x0022=] The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. [=0x0022=]This partly fallen cave may perhaps extend further north.[=0x0022=] The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. [=0x0022=]No telling why this canyon is named after archery, but perhaps if you wait around you[=0x0027=]ll find out.[=0x0022=] The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.[=0x000A=][=0x000A=]Every turn when a random chance of 1 in 10 succeeds:[=0x000A=][=0x0009=]say [=0x0022=]A dwarf appears out of nowhere, and throws a nasty little knife.[=0x0022=];[=0x000A=][=0x0009=]have the player slain.[=0x000A=][=0x000A=][And as compensation for these hazards:][=0x000A=][=0x000A=]Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.[=0x000A=][=0x000A=]Table of Point Values[=0x000A=]item [=0x0009=]  [=0x0009=]score[=0x000A=]silver bars[=0x0009=]3[=0x000A=]platinum pyramid[=0x0009=]10[=0x000A=]emerald[=0x0009=]4[=0x000A=][=0x000A=]Report taking an item listed in the Table of Point Values:[=0x000A=][=0x0009=]increase the score by the score entry;[=0x000A=][=0x0009=]blank out the whole row.[=0x000A=][=0x000A=][We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.][=0x000A=][=0x000A=]Table of Ghostly Presences[=0x000A=]haunted position[=0x0009=]score at death[=0x0009=]turns at death[=0x0009=]manner of death[=0x0009=]sequence[=0x000A=]a grid location[=0x0009=]a number[=0x0009=]a number[=0x0009=]a demise[=0x0009=]a number[=0x000A=]with 19 blank rows.[=0x000A=][=0x000A=][As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.][=0x000A=][=0x000A=]The File of Ghosts is called [=0x0022=]ghosts[=0x0022=].[=0x000A=][=0x000A=]When play begins:[=0x000A=][=0x0009=]if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;[=0x000A=][=0x0009=]sort the Table of Ghostly Presences in sequence order.[=0x000A=][=0x000A=][How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...][=0x000A=][=0x000A=]After looking:[=0x000A=][=0x0009=]repeat through the Table of Ghostly Presences in reverse sequence order:[=0x000A=][=0x0009=][=0x0009=]if the haunted position entry is the coordinates of the location, say [=0x0022=]You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.[=0x0022=][=0x000A=][=0x000A=][(For instance, [=0x0022=]You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.[=0x0022=]) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)][=0x000A=][=0x000A=]To have the player (sticky end - a demise):[=0x000A=][=0x0009=]let the new sequence number be 0;[=0x000A=][=0x0009=]repeat through the Table of Ghostly Presences:[=0x000A=][=0x0009=][=0x0009=]let S be the sequence entry;[=0x000A=][=0x0009=][=0x0009=]if S is greater than the new sequence number, let the new sequence number be S;[=0x000A=][=0x0009=]increment the new sequence number;[=0x000A=][=0x0009=]if the number of blank rows in the Table of Ghostly Presences is 0:[=0x000A=][=0x0009=][=0x0009=]choose row 1 in the Table of Ghostly Presences;[=0x000A=][=0x0009=][=0x0009=]blank out the whole row;[=0x000A=][=0x0009=]choose a blank row in the Table of Ghostly Presences;[=0x000A=][=0x0009=]now the sequence entry is the new sequence number;[=0x000A=][=0x0009=]now the manner of death entry is the sticky end;[=0x000A=][=0x0009=]now the turns at death entry is the turn count;[=0x000A=][=0x0009=]now the score at death entry is the score;[=0x000A=][=0x0009=]now the haunted position entry is the coordinates of the location;[=0x000A=][=0x0009=]write the File of Ghosts from the Table of Ghostly Presences;[=0x000A=][=0x0009=]now the latest demise is the sticky end;[=0x000A=][=0x0009=]end the story saying [=0x0022=]You have been [latest demise][=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Labyrinth of Ghosts&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18466" -->
<a id="c18466"></a><blockquote class="code"><p class="quoted">
Use scoring.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18467" -->
<a id="c18467"></a><blockquote class="code"><p class="quoted">
A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18468" -->
<a id="c18468"></a><blockquote class="code"><p class="quoted">
A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18469" -->
<a id="c18469"></a><blockquote class="code"><p class="quoted">
The Gateway is a room. &quot;For the foolhardy adventurer, the perilous labyrinth lies north, east or south.&quot; The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. &quot;This partly fallen cave may perhaps extend further north.&quot; The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. &quot;No telling why this canyon is named after archery, but perhaps if you wait around you'll find out.&quot; The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18470" -->
<a id="c18470"></a><blockquote class="code"><p class="quoted">
Every turn when a random chance of 1 in 10 succeeds:
<br />&#160;&#160;&#160;&#160;say &quot;A dwarf appears out of nowhere, and throws a nasty little knife.&quot;;
<br />&#160;&#160;&#160;&#160;have the player slain.
</p></blockquote>
<!-- END CODE -->
<p>And as compensation for these hazards:</p>
<!-- START CODE "c18471" -->
<a id="c18471"></a><blockquote class="code"><p class="quoted">
Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18472" -->
<a id="c18472"></a><blockquote class="code"><p class="quoted">
Table of Point Values
<br />item 	  	score
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">silver bars</p></td><td class="quotedtablecell"><p class="quoted">3</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">platinum pyramid</p></td><td class="quotedtablecell"><p class="quoted">10</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">emerald</p></td><td class="quotedtablecell"><p class="quoted">4</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18473" -->
<a id="c18473"></a><blockquote class="code"><p class="quoted">
Report taking an item listed in the Table of Point Values:
<br />&#160;&#160;&#160;&#160;increase the score by the score entry;
<br />&#160;&#160;&#160;&#160;blank out the whole row.
</p></blockquote>
<!-- END CODE -->
<p>We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.</p>
<!-- START CODE "c18474" -->
<a id="c18474"></a><blockquote class="code"><p class="quoted">
Table of Ghostly Presences
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">haunted position</p></td><td class="quotedtablecell"><p class="quoted">score at death</p></td><td class="quotedtablecell"><p class="quoted">turns at death</p></td><td class="quotedtablecell"><p class="quoted">manner of death</p></td><td class="quotedtablecell"><p class="quoted">sequence</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">a grid location</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a demise</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">with 19 blank rows.</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.</p>
<!-- START CODE "c18475" -->
<a id="c18475"></a><blockquote class="code"><p class="quoted">
The File of Ghosts is called &quot;ghosts&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18476" -->
<a id="c18476"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;sort the Table of Ghostly Presences in sequence order.
</p></blockquote>
<!-- END CODE -->
<p>How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...</p>
<!-- START CODE "c18477" -->
<a id="c18477"></a><blockquote class="code"><p class="quoted">
After looking:
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences in reverse sequence order:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the haunted position entry is the coordinates of the location, say &quot;You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.&quot;
</p></blockquote>
<!-- END CODE -->
<p>(For instance, &quot;You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.&quot;) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)</p>
<!-- START CODE "c18478" -->
<a id="c18478"></a><blockquote class="code"><p class="quoted">
To have the player (sticky end - a demise):
<br />&#160;&#160;&#160;&#160;let the new sequence number be 0;
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let S be the sequence entry;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if S is greater than the new sequence number, let the new sequence number be S;
<br />&#160;&#160;&#160;&#160;increment the new sequence number;
<br />&#160;&#160;&#160;&#160;if the number of blank rows in the Table of Ghostly Presences is 0:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;choose row 1 in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blank out the whole row;
<br />&#160;&#160;&#160;&#160;choose a blank row in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the sequence entry is the new sequence number;
<br />&#160;&#160;&#160;&#160;now the manner of death entry is the sticky end;
<br />&#160;&#160;&#160;&#160;now the turns at death entry is the turn count;
<br />&#160;&#160;&#160;&#160;now the score at death entry is the score;
<br />&#160;&#160;&#160;&#160;now the haunted position entry is the coordinates of the location;
<br />&#160;&#160;&#160;&#160;write the File of Ghosts from the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the latest demise is the sticky end;
<br />&#160;&#160;&#160;&#160;end the story saying &quot;You have been [latest demise]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Strictly speaking we ought to worry that after 2,147,483,647 deaths, the sequence numbers would grow too large to store in a single value, and then the sequence of ghosts will be erratic. But it seems unlikely that anyone will play this example 2.1 billion times.</p>
</div>
<!-- EXAMPLE END -->
<div class="egovalforxref overstruckimage">
<!-- EXAMPLE START -->
<a  href="Rex352.html#e352"><i>RB</i></a></div>
<div class="egpanel" id="example352">
<p>A tradition among Nethack-like computer games of the old school is that a player's death in a given place leaves a ghost behind to haunt subsequent players. Information about past lives is sometimes stored in a &quot;bones file&quot;, and in this example we do exactly that, for a grievously unfair little dungeon.</p>
<p>To begin with, the labyrinth itself. We create a kind of value to remember possible means of death in these tunnels, and we assign a coordinate position in some grid to each location. (We do this because grid positions can safely be stored in tables saved out to external files, whereas room names cannot - they represent data which changes each time we amend the source.)</p>
<!-- START CODE "c18479" -->
<a id="c18479"></a><blockquote class="code"><p class="quoted">
<a href="javascript:pasteCode('[=0x0022=]Labyrinth of Ghosts[=0x0022=][=0x000A=][=0x000A=]Use scoring.[=0x000A=][=0x000A=]A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.[=0x000A=][=0x000A=]A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.[=0x000A=][=0x000A=]The Gateway is a room. [=0x0022=]For the foolhardy adventurer, the perilous labyrinth lies north, east or south.[=0x0022=] The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. [=0x0022=]This partly fallen cave may perhaps extend further north.[=0x0022=] The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. [=0x0022=]No telling why this canyon is named after archery, but perhaps if you wait around you[=0x0027=]ll find out.[=0x0022=] The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.[=0x000A=][=0x000A=]Every turn when a random chance of 1 in 10 succeeds:[=0x000A=][=0x0009=]say [=0x0022=]A dwarf appears out of nowhere, and throws a nasty little knife.[=0x0022=];[=0x000A=][=0x0009=]have the player slain.[=0x000A=][=0x000A=][And as compensation for these hazards:][=0x000A=][=0x000A=]Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.[=0x000A=][=0x000A=]Table of Point Values[=0x000A=]item [=0x0009=]  [=0x0009=]score[=0x000A=]silver bars[=0x0009=]3[=0x000A=]platinum pyramid[=0x0009=]10[=0x000A=]emerald[=0x0009=]4[=0x000A=][=0x000A=]Report taking an item listed in the Table of Point Values:[=0x000A=][=0x0009=]increase the score by the score entry;[=0x000A=][=0x0009=]blank out the whole row.[=0x000A=][=0x000A=][We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.][=0x000A=][=0x000A=]Table of Ghostly Presences[=0x000A=]haunted position[=0x0009=]score at death[=0x0009=]turns at death[=0x0009=]manner of death[=0x0009=]sequence[=0x000A=]a grid location[=0x0009=]a number[=0x0009=]a number[=0x0009=]a demise[=0x0009=]a number[=0x000A=]with 19 blank rows.[=0x000A=][=0x000A=][As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.][=0x000A=][=0x000A=]The File of Ghosts is called [=0x0022=]ghosts[=0x0022=].[=0x000A=][=0x000A=]When play begins:[=0x000A=][=0x0009=]if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;[=0x000A=][=0x0009=]sort the Table of Ghostly Presences in sequence order.[=0x000A=][=0x000A=][How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...][=0x000A=][=0x000A=]After looking:[=0x000A=][=0x0009=]repeat through the Table of Ghostly Presences in reverse sequence order:[=0x000A=][=0x0009=][=0x0009=]if the haunted position entry is the coordinates of the location, say [=0x0022=]You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.[=0x0022=][=0x000A=][=0x000A=][(For instance, [=0x0022=]You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.[=0x0022=]) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)][=0x000A=][=0x000A=]To have the player (sticky end - a demise):[=0x000A=][=0x0009=]let the new sequence number be 0;[=0x000A=][=0x0009=]repeat through the Table of Ghostly Presences:[=0x000A=][=0x0009=][=0x0009=]let S be the sequence entry;[=0x000A=][=0x0009=][=0x0009=]if S is greater than the new sequence number, let the new sequence number be S;[=0x000A=][=0x0009=]increment the new sequence number;[=0x000A=][=0x0009=]if the number of blank rows in the Table of Ghostly Presences is 0:[=0x000A=][=0x0009=][=0x0009=]choose row 1 in the Table of Ghostly Presences;[=0x000A=][=0x0009=][=0x0009=]blank out the whole row;[=0x000A=][=0x0009=]choose a blank row in the Table of Ghostly Presences;[=0x000A=][=0x0009=]now the sequence entry is the new sequence number;[=0x000A=][=0x0009=]now the manner of death entry is the sticky end;[=0x000A=][=0x0009=]now the turns at death entry is the turn count;[=0x000A=][=0x0009=]now the score at death entry is the score;[=0x000A=][=0x0009=]now the haunted position entry is the coordinates of the location;[=0x000A=][=0x0009=]write the File of Ghosts from the Table of Ghostly Presences;[=0x000A=][=0x0009=]now the latest demise is the sticky end;[=0x000A=][=0x0009=]end the story saying [=0x0022=]You have been [latest demise][=0x0022=].[=0x000A=][=0x000A=]\n')"><img alt="paste.png" src="Documentation/Images/paste.png" /></a> &quot;Labyrinth of Ghosts&quot;
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18480" -->
<a id="c18480"></a><blockquote class="code"><p class="quoted">
Use scoring.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18481" -->
<a id="c18481"></a><blockquote class="code"><p class="quoted">
A demise is a kind of value. The demises are drowned, buried by a rockfall, pierced by an arrow and slain. The latest demise is a demise that varies.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18482" -->
<a id="c18482"></a><blockquote class="code"><p class="quoted">
A grid location is a kind of value. (1,19) specifies a grid location. A room has a grid location called coordinates.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18483" -->
<a id="c18483"></a><blockquote class="code"><p class="quoted">
The Gateway is a room. &quot;For the foolhardy adventurer, the perilous labyrinth lies north, east or south.&quot; The coordinates are (6,6). The Tomb is east of the Gateway. The coordinates are (7,6). The Rockfall Cave is north of the Gateway. &quot;This partly fallen cave may perhaps extend further north.&quot; The coordinates are (6,5). Instead of going north in the Rockfall Cave, have the player buried by a rockfall. The Archery Canyon is south of the Gateway. &quot;No telling why this canyon is named after archery, but perhaps if you wait around you'll find out.&quot; The coordinates are (6,7). Instead of waiting in the Archery Canyon, have the player pierced by an arrow. The Rock Pool is east of the Tomb. The coordinates are (8,6). The cold mountain pool is in the Rock Pool. The cold pool is fixed in place. Instead of entering the cold mountain pool, have the player drowned.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18484" -->
<a id="c18484"></a><blockquote class="code"><p class="quoted">
Every turn when a random chance of 1 in 10 succeeds:
<br />&#160;&#160;&#160;&#160;say &quot;A dwarf appears out of nowhere, and throws a nasty little knife.&quot;;
<br />&#160;&#160;&#160;&#160;have the player slain.
</p></blockquote>
<!-- END CODE -->
<p>And as compensation for these hazards:</p>
<!-- START CODE "c18485" -->
<a id="c18485"></a><blockquote class="code"><p class="quoted">
Some silver bars are in the Tomb. The emerald is in the Rock Pool. The platinum pyramid is in the Canyon.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18486" -->
<a id="c18486"></a><blockquote class="code"><p class="quoted">
Table of Point Values
<br />item 	  	score
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">silver bars</p></td><td class="quotedtablecell"><p class="quoted">3</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">platinum pyramid</p></td><td class="quotedtablecell"><p class="quoted">10</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">emerald</p></td><td class="quotedtablecell"><p class="quoted">4</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18487" -->
<a id="c18487"></a><blockquote class="code"><p class="quoted">
Report taking an item listed in the Table of Point Values:
<br />&#160;&#160;&#160;&#160;increase the score by the score entry;
<br />&#160;&#160;&#160;&#160;blank out the whole row.
</p></blockquote>
<!-- END CODE -->
<p>We are now ready for the actual undertaking. The Table of Ghostly Presences holds up to twenty death notices, and is initially blank. Deaths are sequentially numbered, and this number is stored in the sequence column.</p>
<!-- START CODE "c18488" -->
<a id="c18488"></a><blockquote class="code"><p class="quoted">
Table of Ghostly Presences
<br /></p></blockquote><table class="codetable">
<tr><td class="quotedtablecell"><p class="quoted">haunted position</p></td><td class="quotedtablecell"><p class="quoted">score at death</p></td><td class="quotedtablecell"><p class="quoted">turns at death</p></td><td class="quotedtablecell"><p class="quoted">manner of death</p></td><td class="quotedtablecell"><p class="quoted">sequence</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">a grid location</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td><td class="quotedtablecell"><p class="quoted">a demise</p></td><td class="quotedtablecell"><p class="quoted">a number</p></td></tr>
<tr><td class="quotedtablecell"><p class="quoted">with 19 blank rows.</p></td></tr>
</table><blockquote><p>
</p></blockquote>
<!-- END CODE -->
<p>As the story file starts up, we look to see if a ghosts file already exists. If one does, we load up the Table of Ghostly Presences with it: and if not, as will be the case the first time the player explores, we leave the table blank. We sort the table so that it has earlier deaths (lower sequence numbers) first.</p>
<!-- START CODE "c18489" -->
<a id="c18489"></a><blockquote class="code"><p class="quoted">
The File of Ghosts is called &quot;ghosts&quot;.
</p></blockquote>
<!-- END CODE -->
<!-- START CODE "c18490" -->
<a id="c18490"></a><blockquote class="code"><p class="quoted">
When play begins:
<br />&#160;&#160;&#160;&#160;if the File of Ghosts exists, read File of Ghosts into the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;sort the Table of Ghostly Presences in sequence order.
</p></blockquote>
<!-- END CODE -->
<p>How will ghosts manifest themselves? Because this is only a small example, we will simply tell the player that he senses something. If several ghosts are present in the same place, the most aggrieved (that is, the most recent) is sensed first...</p>
<!-- START CODE "c18491" -->
<a id="c18491"></a><blockquote class="code"><p class="quoted">
After looking:
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences in reverse sequence order:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if the haunted position entry is the coordinates of the location, say &quot;You sense the ghostly presence of an adventurer, [manner of death entry] with a score of [score at death entry] in [turns at death entry] turns.&quot;
</p></blockquote>
<!-- END CODE -->
<p>(For instance, &quot;You sense the ghostly presence of an adventurer, buried by a rockfall with a score of 10 in 5 turns.&quot;) That just leaves the rule for bumping off the player. When the Table is full, and there are already 20 ghosts, the one who died longest ago (with the lowest sequence count) is eliminated, and his row blanked out. (This will always be row 1 since we sorted the table in sequence order on reading it in.)</p>
<!-- START CODE "c18492" -->
<a id="c18492"></a><blockquote class="code"><p class="quoted">
To have the player (sticky end - a demise):
<br />&#160;&#160;&#160;&#160;let the new sequence number be 0;
<br />&#160;&#160;&#160;&#160;repeat through the Table of Ghostly Presences:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let S be the sequence entry;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if S is greater than the new sequence number, let the new sequence number be S;
<br />&#160;&#160;&#160;&#160;increment the new sequence number;
<br />&#160;&#160;&#160;&#160;if the number of blank rows in the Table of Ghostly Presences is 0:
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;choose row 1 in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blank out the whole row;
<br />&#160;&#160;&#160;&#160;choose a blank row in the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the sequence entry is the new sequence number;
<br />&#160;&#160;&#160;&#160;now the manner of death entry is the sticky end;
<br />&#160;&#160;&#160;&#160;now the turns at death entry is the turn count;
<br />&#160;&#160;&#160;&#160;now the score at death entry is the score;
<br />&#160;&#160;&#160;&#160;now the haunted position entry is the coordinates of the location;
<br />&#160;&#160;&#160;&#160;write the File of Ghosts from the Table of Ghostly Presences;
<br />&#160;&#160;&#160;&#160;now the latest demise is the sticky end;
<br />&#160;&#160;&#160;&#160;end the story saying &quot;You have been [latest demise]&quot;.
</p></blockquote>
<!-- END CODE -->
<p>Strictly speaking we ought to worry that after 2,147,483,647 deaths, the sequence numbers would grow too large to store in a single value, and then the sequence of ghosts will be erratic. But it seems unlikely that anyone will play this example 2.1 billion times.</p>
</div>
<!-- EXAMPLE END -->
<!-- END IGNORE -->
</td></tr></table>
<a id="e422"></a><table class="egcue"><tr><td class="egcellforoval"><div class="egovalfornumber overstruckimage">
<a href="ex422.html#e422" class="eglink"><b>442</b></a></div>
</td><td class="egnamecell"><p class="egcuetext"><a href="ex422.html#e422" class="eglink"><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><img class="asterisk" alt="*" src="Documentation/Images/asterisk.png" /><b><span class="egbanner">Example</span><span class="egname">Rubies</span></b></a><br />A scoreboard that keeps track of the ten highest-scoring players from one playthrough to the next, adding the player's name if he has done well enough.</p></td><td class="egcrossref"><!-- START IGNORE -->
<div class="egovalforxref overstruckimage">
<a  href="Rex422.html#e422"><i>RB</i></a></div>
<!-- END IGNORE -->
</td></tr></table>
<hr />
</div>
<!-- START IGNORE -->
<!-- END IGNORE -->
</body>
</html>
